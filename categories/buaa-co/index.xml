<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>BUAA-CO on Az's Blog</title><link>https://lhy0424.top/categories/buaa-co/</link><description>Recent content in BUAA-CO on Az's Blog</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Fri, 20 Dec 2024 00:32:00 +0000</lastBuildDate><atom:link href="https://lhy0424.top/categories/buaa-co/index.xml" rel="self" type="application/rss+xml"/><item><title>P7_设计文档</title><link>https://lhy0424.top/p/co_p7/</link><pubDate>Fri, 20 Dec 2024 00:32:00 +0000</pubDate><guid>https://lhy0424.top/p/co_p7/</guid><description>&lt;img src="https://lhy0424.top/p/co_p7/P7_cover.jpg" alt="Featured image of post P7_设计文档" />&lt;h1 id="p7_mips微系统">P7_MIPS微系统
&lt;/h1>&lt;h2 id="预备知识">预备知识
&lt;/h2>&lt;h3 id="异常程序处理">异常程序处理
&lt;/h3>&lt;p>先要明白一点，Mars不会帮你处理中断异常，Mars遇到异常指令或中断信号会跳至中断异常处理程序（0x4180之后），如何处理中断异常完全由0x4180之后的代码决定。&lt;/p>
&lt;p>先看课程组给出的示例程序&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 程序首先从这里运行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.text
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 只允许外部中断&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ori &lt;span class="nv">$t0&lt;/span>, &lt;span class="nv">$0&lt;/span>, 0x1001
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mtc0 &lt;span class="nv">$t0&lt;/span>, &lt;span class="nv">$12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 算术溢出&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> lui &lt;span class="nv">$t0&lt;/span>, 0x7fff
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> lui &lt;span class="nv">$t1&lt;/span>, 0x7fff
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add &lt;span class="nv">$t2&lt;/span>, &lt;span class="nv">$t0&lt;/span>, &lt;span class="nv">$t1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> beq &lt;span class="nv">$0&lt;/span>, &lt;span class="nv">$0&lt;/span>, end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.ktext 0x4180
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">_entry:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 保存上下文&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> j _save_context
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">_main_handler:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 取出 ExcCode&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mfc0 &lt;span class="nv">$k0&lt;/span>, &lt;span class="nv">$13&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ori &lt;span class="nv">$k1&lt;/span>, &lt;span class="nv">$0&lt;/span>, 0x7c
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> and &lt;span class="nv">$k0&lt;/span>, &lt;span class="nv">$k0&lt;/span>, &lt;span class="nv">$k1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 如果是中断，直接恢复上下文&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> beq &lt;span class="nv">$k0&lt;/span>, &lt;span class="nv">$0&lt;/span>, _restore_context
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 将 EPC + 4，即处理异常的方法就是跳过当前指令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mfc0 &lt;span class="nv">$k0&lt;/span>, &lt;span class="nv">$14&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> addu &lt;span class="nv">$k0&lt;/span>, &lt;span class="nv">$k0&lt;/span>, &lt;span class="m">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mtc0 &lt;span class="nv">$k0&lt;/span>, &lt;span class="nv">$14&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> j _restore_context
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">_exception_return:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> eret
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">_save_context:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ori &lt;span class="nv">$k0&lt;/span>, &lt;span class="nv">$0&lt;/span>, 0x1000 &lt;span class="c1"># 在栈上找一块空间保存现场&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> addiu &lt;span class="nv">$k0&lt;/span>, &lt;span class="nv">$k0&lt;/span>, -256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sw &lt;span class="nv">$sp&lt;/span>, 116&lt;span class="o">(&lt;/span>&lt;span class="nv">$k0&lt;/span>&lt;span class="o">)&lt;/span> &lt;span class="c1"># 最先保存栈指针&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> move &lt;span class="nv">$sp&lt;/span>, &lt;span class="nv">$k0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 依次保存通用寄存器（注意要跳过 $sp）、HI 和 LO&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sw &lt;span class="nv">$1&lt;/span>, 4&lt;span class="o">(&lt;/span>&lt;span class="nv">$sp&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sw &lt;span class="nv">$2&lt;/span>, 8&lt;span class="o">(&lt;/span>&lt;span class="nv">$sp&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ......&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sw &lt;span class="nv">$31&lt;/span>, 124&lt;span class="o">(&lt;/span>&lt;span class="nv">$sp&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mfhi &lt;span class="nv">$k0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mflo &lt;span class="nv">$k1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sw &lt;span class="nv">$k0&lt;/span>, 128&lt;span class="o">(&lt;/span>&lt;span class="nv">$sp&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sw &lt;span class="nv">$k1&lt;/span>, 132&lt;span class="o">(&lt;/span>&lt;span class="nv">$sp&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> j _main_handler
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">_restore_context:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 依次恢复通用寄存器（注意要跳过 $sp）、 HI 和 LO&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> lw &lt;span class="nv">$1&lt;/span>, 4&lt;span class="o">(&lt;/span>&lt;span class="nv">$sp&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> lw &lt;span class="nv">$2&lt;/span>, 8&lt;span class="o">(&lt;/span>&lt;span class="nv">$sp&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ......&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> lw &lt;span class="nv">$31&lt;/span>, 124&lt;span class="o">(&lt;/span>&lt;span class="nv">$sp&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> lw &lt;span class="nv">$k0&lt;/span>, 128&lt;span class="o">(&lt;/span>&lt;span class="nv">$sp&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> lw &lt;span class="nv">$k1&lt;/span>, 132&lt;span class="o">(&lt;/span>&lt;span class="nv">$sp&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mthi &lt;span class="nv">$k0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mtlo &lt;span class="nv">$k1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 最后恢复栈指针&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> lw &lt;span class="nv">$sp&lt;/span>, 116&lt;span class="o">(&lt;/span>&lt;span class="nv">$sp&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> j _exception_return
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nop
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="代码解释">代码解释
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>&lt;strong>.text:&lt;/strong> Subsequent items (instructions) stored in Text segment at next available address.随后的条目（指令）存储在文本段的下一个可用地址中。普通的用户模式下的代码段，简单来说就是存指令的地方。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>.ktext:&lt;/strong> Subsequent items stored in Kernel Text segment at next available address.随后的条目存储在内核文本段的下一个可用地址中。即内核模式下的代码段，内核模式下运行，具有最高权限，可以直接访问硬件和受保护的资源。对于p7来说就是存放异常处理程序的地方。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>异常包括很多种类型，中断和异常也不同，不同的异常或中断处理方式不一样，因此我们需要记录下异常或中断的信息，然后用特定方式处理异常，这就是CP0（协处理器）的作用。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>进入中断异常处理程序后，我们先从CP0中获取异常或中断信息，然后跳转至不同的地方处理异常中断，一般最后都会跳转到eret，返回主程序。&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="cpu与外设的交互">CPU与外设的交互
&lt;/h3>&lt;p>CPU的作用就是对外界输入数据做出对应的处理后返回结果。&lt;/p>
&lt;h4 id="外设">外设
&lt;/h4>&lt;p>对于p7，我们有三个外设需要处理。这三个外设的作用就是时不时向cpu发出一个中断信号。&lt;/p>
&lt;ul>
&lt;li>计时器（Timer）：计算机系统中的计时部件，可以按照配置定时地产生时钟中断。&lt;/li>
&lt;li>存储器（Memory）：计算机系统中的存储部件，用于存储指令和数据。我们在 P6 的时候已经接触过了。&lt;/li>
&lt;li>中断发生器（InterruptGenerator）：抽象的计算机系统外设，会随机的产生外部中断信号，产生的中断信号在 CPU 响应前会持续置高。&lt;/li>
&lt;/ul>
&lt;h4 id="内存">内存
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>我们可以认为内存也是一种外设。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>我们可以认为指令、数据、异常处理程序、外设寄存器等都是储存在同一内存中，只不过存储的位置不同，有着严格的界限。&lt;/p>
&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>条目&lt;/strong>&lt;/th>
&lt;th>&lt;strong>地址或地址范围&lt;/strong>&lt;/th>
&lt;th>&lt;strong>备注&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>数据存储器&lt;/td>
&lt;td>&lt;em>&lt;strong>0x0000_0000&lt;/strong>&lt;/em>∼&lt;em>&lt;strong>0x0000_2FFF&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>指令存储器&lt;/td>
&lt;td>&lt;em>&lt;strong>0x0000_3000&lt;/strong>&lt;/em>∼&lt;em>&lt;strong>0x0000_6FFF&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>PC 初始值&lt;/td>
&lt;td>&lt;em>&lt;strong>0x0000_3000&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>异常处理程序入口地址&lt;/td>
&lt;td>&lt;em>&lt;strong>0x0000_4180&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>计时器 0 寄存器地址&lt;/td>
&lt;td>&lt;em>&lt;strong>0x0000_7F00&lt;/strong>&lt;/em>∼&lt;em>&lt;strong>0x0000_7F0B&lt;/strong>&lt;/em>&lt;/td>
&lt;td>计时器 0 的 3 个寄存器&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>计时器 1 寄存器地址&lt;/td>
&lt;td>&lt;em>&lt;strong>0x0000_7F10&lt;/strong>&lt;/em>∼&lt;em>&lt;strong>0x0000_7F1B&lt;/strong>&lt;/em>&lt;/td>
&lt;td>计时器 1 的 3 个寄存器&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>中断发生器响应地址&lt;/td>
&lt;td>&lt;em>&lt;strong>0x0000_7F20&lt;/strong>&lt;/em>∼&lt;em>&lt;strong>0x0000_7F23&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="宏观pc">宏观PC
&lt;/h3>&lt;p>对于流水线寄存器，每一流水级的PC都不同。我们希望CPU实现的功能应该是单周期的，引入多周期只是为了提高效率。如果我们把CPU封装起来，不关注内部的复杂过程，在外部看来CPU应该只有一个PC，即CPU一个周期仅执行一条指令。为此我们需要引入宏观PC的概念。&lt;/p>
&lt;ul>
&lt;li>我们将 CP0 放在 M 级（大家都放在M级，方便对拍），因此也以 M 级为界线，规定 M 级的 PC 就是宏观 PC。&lt;/li>
&lt;li>**所谓“宏观”指令，表示该指令之前的所有指令序列对 CPU 的更新已完成，该指令及其之后的指令序列对 CPU 的更新未完成。**放在M级显然满足这个定义。&lt;/li>
&lt;/ul>
&lt;h2 id="tasks">Tasks
&lt;/h2>&lt;h3 id="task-1-建立与外界的联系">Task-1: 建立与外界的联系
&lt;/h3>&lt;h4 id="timer">Timer
&lt;/h4>&lt;ul>
&lt;li>Timer内部有三个寄存器: 0号寄存器ctrl、1号寄存器preset、2号寄存器count。虽然说是寄存器，但我们可以认为其实内存的一部分。&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>0号寄存器ctrl&lt;/th>
&lt;th>1号寄存器preset&lt;/th>
&lt;th>2号寄存器count&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>TC1&lt;/td>
&lt;td>&lt;em>&lt;strong>0x0000_7F00&lt;/strong>&lt;/em>∼&lt;em>&lt;strong>0x0000_7F03&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;em>&lt;strong>0x0000_7F04&lt;/strong>&lt;/em>∼&lt;em>&lt;strong>0x0000_7F07&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;em>&lt;strong>0x0000_7F08&lt;/strong>&lt;/em>∼&lt;em>&lt;strong>0x0000_7F0b&lt;/strong>&lt;/em>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>TC2&lt;/td>
&lt;td>&lt;em>&lt;strong>0x0000_7F10&lt;/strong>&lt;/em>∼&lt;em>&lt;strong>0x0000_7F13&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;em>&lt;strong>0x0000_7F14&lt;/strong>&lt;/em>∼&lt;em>&lt;strong>0x0000_7F17&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;em>&lt;strong>0x0000_7F18&lt;/strong>&lt;/em>∼&lt;em>&lt;strong>0x0000_7F1b&lt;/strong>&lt;/em>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;ul>
&lt;li>
&lt;p>我们可以通过sw指令向对应Timer寄存器中存值以开启计时并调整倒计时。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># MODE 0 for timer1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ori &lt;span class="nv">$t1&lt;/span> &lt;span class="nv">$0&lt;/span> &lt;span class="m">9&lt;/span> &lt;span class="c1">#设置计时使能和中断屏蔽&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sw &lt;span class="nv">$t1&lt;/span> 0x7F00&lt;span class="o">(&lt;/span>&lt;span class="nv">$0&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ori &lt;span class="nv">$t1&lt;/span> &lt;span class="nv">$0&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="c1">#设置计时数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sw &lt;span class="nv">$t1&lt;/span> 0x7F04&lt;span class="o">(&lt;/span>&lt;span class="nv">$0&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># MODE 1 for timer1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ori &lt;span class="nv">$t1&lt;/span> &lt;span class="nv">$0&lt;/span> &lt;span class="m">11&lt;/span> &lt;span class="c1">#设置计时使能和中断屏蔽&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sw &lt;span class="nv">$t1&lt;/span> 0x7F00&lt;span class="o">(&lt;/span>&lt;span class="nv">$0&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ori &lt;span class="nv">$t1&lt;/span> &lt;span class="nv">$0&lt;/span> &lt;span class="m">10&lt;/span> &lt;span class="c1">#设置计时数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sw &lt;span class="nv">$t1&lt;/span> 0x7F04&lt;span class="o">(&lt;/span>&lt;span class="nv">$0&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="task-2-记录异常并流水">Task-2: 记录异常并流水
&lt;/h3>&lt;ul>
&lt;li>where CP0: M级。&lt;/li>
&lt;li>延迟槽指令: 如果一个处于延迟槽的指令发生了异常，我们从异常处理程序中返回时需要回到它的上一个指令（跳转指令）。因此我们需要增加判断一个信号用于判断指令是否在延迟槽中，并向后流水传至CP0。（branch、jump、jal、jr在ID级，IF级的指令即处于延迟槽中）。&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl">&lt;span class="k">assign&lt;/span> &lt;span class="n">BD_IF&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">branch_ID&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="mb">&amp;#39;b1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">jump_ID&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="mb">&amp;#39;b1&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="mb">&amp;#39;b1&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">1&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>内部异常和外部中断：同时发生时处理外部中断，当内部无异常时设为Int(外部中断)。&lt;/li>
&lt;li>一条指令多个异常 &amp;amp; 多个指令异常：&lt;strong>优先处理最早可以探查到的异常&lt;/strong>。&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: left">异常与中断码&lt;/th>
&lt;th style="text-align: left">助记符与名称&lt;/th>
&lt;th style="text-align: left">指令与指令类型&lt;/th>
&lt;th style="text-align: left">描述&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: left">0&lt;/td>
&lt;td style="text-align: left">&lt;code>Int&lt;/code> （外部中断）&lt;/td>
&lt;td style="text-align: left">所有指令&lt;/td>
&lt;td style="text-align: left">中断请求，来源于计时器与外部中断。&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">4&lt;/td>
&lt;td style="text-align: left">&lt;code>AdEL&lt;/code> （取指异常）&lt;/td>
&lt;td style="text-align: left">所有指令&lt;/td>
&lt;td style="text-align: left">PC 地址未字对齐。&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">4&lt;/td>
&lt;td style="text-align: left">&lt;code>AdEL&lt;/code> （取指异常）&lt;/td>
&lt;td style="text-align: left">所有指令&lt;/td>
&lt;td style="text-align: left">PC 地址超过 &lt;code>0x3000 ~ 0x6ffc&lt;/code>。&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">4&lt;/td>
&lt;td style="text-align: left">&lt;code>AdEL&lt;/code> （取数异常）&lt;/td>
&lt;td style="text-align: left">&lt;code>lw&lt;/code>&lt;/td>
&lt;td style="text-align: left">取数地址未与 4 字节对齐。&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">4&lt;/td>
&lt;td style="text-align: left">&lt;code>AdEL&lt;/code> （取数异常）&lt;/td>
&lt;td style="text-align: left">&lt;code>lh&lt;/code>&lt;/td>
&lt;td style="text-align: left">取数地址未与 2 字节对齐。&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">4&lt;/td>
&lt;td style="text-align: left">&lt;code>AdEL&lt;/code> （取数异常）&lt;/td>
&lt;td style="text-align: left">&lt;code>lh&lt;/code>, &lt;code>lb&lt;/code>&lt;/td>
&lt;td style="text-align: left">取 Timer 寄存器的值。&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">4&lt;/td>
&lt;td style="text-align: left">&lt;code>AdEL&lt;/code> （取数异常）&lt;/td>
&lt;td style="text-align: left">load 型指令&lt;/td>
&lt;td style="text-align: left">计算地址时加法溢出。&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">4&lt;/td>
&lt;td style="text-align: left">&lt;code>AdEL&lt;/code> （取数异常）&lt;/td>
&lt;td style="text-align: left">load 型指令&lt;/td>
&lt;td style="text-align: left">取数地址超出 DM、Timer0、Timer1、中断发生器的范围。&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">5&lt;/td>
&lt;td style="text-align: left">&lt;code>AdES&lt;/code> （存数异常）&lt;/td>
&lt;td style="text-align: left">&lt;code>sw&lt;/code>&lt;/td>
&lt;td style="text-align: left">存数地址未 4 字节对齐。&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">5&lt;/td>
&lt;td style="text-align: left">&lt;code>AdES&lt;/code> （存数异常）&lt;/td>
&lt;td style="text-align: left">&lt;code>sh&lt;/code>&lt;/td>
&lt;td style="text-align: left">存数地址未 2 字节对齐。&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">5&lt;/td>
&lt;td style="text-align: left">&lt;code>AdES&lt;/code> （存数异常）&lt;/td>
&lt;td style="text-align: left">&lt;code>sh&lt;/code>, &lt;code>sb&lt;/code>&lt;/td>
&lt;td style="text-align: left">存 Timer 寄存器的值。&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">5&lt;/td>
&lt;td style="text-align: left">&lt;code>AdES&lt;/code> （存数异常）&lt;/td>
&lt;td style="text-align: left">store 型指令&lt;/td>
&lt;td style="text-align: left">计算地址加法溢出。&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">5&lt;/td>
&lt;td style="text-align: left">&lt;code>AdES&lt;/code> （存数异常）&lt;/td>
&lt;td style="text-align: left">store 型指令&lt;/td>
&lt;td style="text-align: left">向计时器的 Count 寄存器存值。&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">5&lt;/td>
&lt;td style="text-align: left">&lt;code>AdES&lt;/code> （存数异常）&lt;/td>
&lt;td style="text-align: left">store 型指令&lt;/td>
&lt;td style="text-align: left">存数地址超出 DM、Timer0、Timer1、中断发生器的范围。&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">8&lt;/td>
&lt;td style="text-align: left">&lt;code>Syscall&lt;/code> （系统调用）&lt;/td>
&lt;td style="text-align: left">&lt;code>syscall&lt;/code>&lt;/td>
&lt;td style="text-align: left">系统调用。&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">10&lt;/td>
&lt;td style="text-align: left">&lt;code>RI&lt;/code>（未知指令）&lt;/td>
&lt;td style="text-align: left">-&lt;/td>
&lt;td style="text-align: left">未知的指令码。&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">12&lt;/td>
&lt;td style="text-align: left">&lt;code>Ov&lt;/code>（溢出异常）&lt;/td>
&lt;td style="text-align: left">&lt;code>add&lt;/code>, &lt;code>addi&lt;/code>, &lt;code>sub&lt;/code>&lt;/td>
&lt;td style="text-align: left">算术溢出。&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="if级">IF级
&lt;/h4>&lt;ul>
&lt;li>PC 地址未字对齐 &lt;code>AdEL&lt;/code>&lt;/li>
&lt;li>PC 地址超过 0x3000 ~ 0x6ffc &lt;code>AdEL&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// in PC module
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">assign&lt;/span> &lt;span class="n">exc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">pc&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mh">32&amp;#39;h3000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">pc&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mh">32&amp;#39;h6ffc&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">4&lt;/span>&lt;span class="mi">&amp;#39;d4&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">pc&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">4&lt;/span>&lt;span class="mi">&amp;#39;d4&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mh">4&lt;/span>&lt;span class="mi">&amp;#39;d0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="id级">ID级
&lt;/h4>&lt;ul>
&lt;li>未知的指令码 &lt;code>RI&lt;/code>&lt;/li>
&lt;li>syscall 对于syscall指令我们只需发出一个异常信号即可 &lt;code>syscall&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>如果有if嵌套，注意内部if对应的else也需要判断为未知指令。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// in controller module
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">OpCode&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">xxxxxx&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Funct&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">xxxxxx&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//ctrl signal assignment
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//exception RI
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">exc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">4&lt;/span>&lt;span class="mi">&amp;#39;d10&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">OpCode&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">xxxxxx&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//ctrl signal assignment
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">else&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//exception RI
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">exc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">4&lt;/span>&lt;span class="mi">&amp;#39;d10&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="ex级">EX级
&lt;/h4>&lt;ul>
&lt;li>算术溢出 &lt;code>OV&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">32&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">A_ext&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">32&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">B_ext&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">32&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">addi_temp&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">A_ext&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">B_ext&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">addi_overflow&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">F&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="no">`ADDI&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">addi_temp&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">32&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">addi_temp&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="p">]));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">32&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">add_temp&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">A_ext&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">B_ext&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">add_overflow&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">F&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="no">`ADD&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">add_temp&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">32&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">add_temp&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="p">]));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">32&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">sub_temp&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">A_ext&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">B_ext&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">sub_overflow&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">F&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="no">`SUB&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">sub_temp&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">32&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">sub_temp&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="p">]));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">assign&lt;/span> &lt;span class="n">exc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">addi_overflow&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">add_overflow&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">sub_overflow&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">4&lt;/span>&lt;span class="mi">&amp;#39;d12&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mh">4&lt;/span>&lt;span class="mi">&amp;#39;d0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="ma级">MA级
&lt;/h4>&lt;ul>
&lt;li>load类指令
&lt;ul>
&lt;li>lw取数地址未与 4 字节对齐 &lt;code>AdEL&lt;/code>&lt;/li>
&lt;li>lh、lb取数地址未与 2 字节对齐 &lt;code>AdEL&lt;/code>&lt;/li>
&lt;li>lh、lb取 Timer 寄存器的值：寄存器的值为32位，取半字或比特是非法行为非法 &lt;code>AdEL&lt;/code>&lt;/li>
&lt;li>计算地址时加法溢出 &lt;code>AdEL&lt;/code>&lt;/li>
&lt;li>取数地址超出 DM、Timer0、Timer1、中断发生器的范围 &lt;code>AdEL&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>store类指令
&lt;ul>
&lt;li>sw存数地址未 4 字节对齐 &lt;code>AdES&lt;/code>&lt;/li>
&lt;li>sh、sb存数地址未 2 字节对齐 &lt;code>AdES&lt;/code>&lt;/li>
&lt;li>sh、sb存 Timer 寄存器的值 ：寄存器的值为32位，存半字或比特是非法行为非法 &lt;code>AdES&lt;/code>&lt;/li>
&lt;li>计算地址加法溢出 &lt;code>AdES&lt;/code>&lt;/li>
&lt;li>向计时器的 Count 寄存器存值 ：计时器的count寄存器是只读寄存器(read-only) &lt;code>AdES&lt;/code>&lt;/li>
&lt;li>存数地址超出 DM、Timer0、Timer1、中断发生器的范围 &lt;code>AdES&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//load EXC
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">wire&lt;/span> &lt;span class="n">exc_load_align&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(((&lt;/span>&lt;span class="n">load_type_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b111&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">byte_offset&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="c1">//lw
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">load_type_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b100&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">byte_offset&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">)));&lt;/span> &lt;span class="c1">//lh
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">exc_load_adov&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">load_type_MA&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">EX_EXCCode_pip_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">4&lt;/span>&lt;span class="mi">&amp;#39;d12&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">exc_load_OutOfRange&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">!&lt;/span>&lt;span class="p">(((&lt;/span>&lt;span class="n">ALU_C_MA&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="mh">32&amp;#39;h0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">ALU_C_MA&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">32&amp;#39;h2fff&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="c1">//DM
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">ALU_C_MA&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="mh">32&amp;#39;h7f00&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">ALU_C_MA&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">32&amp;#39;h7f0b&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="c1">//TC0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">ALU_C_MA&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="mh">32&amp;#39;h7f10&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">ALU_C_MA&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">32&amp;#39;h7f1b&lt;/span>&lt;span class="p">)));&lt;/span> &lt;span class="c1">//TC1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">exc_load_timer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">load_type_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b100&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">load_type_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b010&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">ALU_C_MA&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="mh">32&amp;#39;h7f00&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">EXCCode_ADEL&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">load_type_MA&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">exc_load_align&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">exc_load_adov&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">exc_load_OutOfRange&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">exc_load_timer&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//store EXC
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">wire&lt;/span> &lt;span class="n">exc_store_align&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(((&lt;/span>&lt;span class="n">store_type_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b001&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">byte_offset&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="o">||&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">((&lt;/span>&lt;span class="n">store_type_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b100&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">byte_offset&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">)));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">exc_store_adov&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">store_type_MA&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">EX_EXCCode_pip_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">4&lt;/span>&lt;span class="mi">&amp;#39;d12&lt;/span>&lt;span class="p">));&lt;/span> &lt;span class="c1">//addr overflow
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">exc_store_OutOfRange&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">!&lt;/span>&lt;span class="p">(((&lt;/span>&lt;span class="n">ALU_C_MA&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="mh">32&amp;#39;h0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">ALU_C_MA&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">32&amp;#39;h2fff&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="c1">//DM
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">ALU_C_MA&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="mh">32&amp;#39;h7f00&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">ALU_C_MA&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">32&amp;#39;h7f0b&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="c1">//TC0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">ALU_C_MA&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="mh">32&amp;#39;h7f10&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">ALU_C_MA&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">32&amp;#39;h7f1b&lt;/span>&lt;span class="p">)));&lt;/span> &lt;span class="c1">//TC1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">exc_store_timer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">store_type_MA&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">ALU_C_MA&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="mh">32&amp;#39;h0000&lt;/span>&lt;span class="n">_7f08&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">ALU_C_MA&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">32&amp;#39;h0000&lt;/span>&lt;span class="n">_7f0b&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">||&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">store_type_MA&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">ALU_C_MA&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="mh">32&amp;#39;h0000&lt;/span>&lt;span class="n">_7f18&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">ALU_C_MA&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">32&amp;#39;h0000&lt;/span>&lt;span class="n">_7f1b&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">||&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">((&lt;/span>&lt;span class="n">store_type_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b010&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">store_type_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b100&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">ALU_C_MA&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="mh">32&amp;#39;h7f00&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">EXCCode_ADES&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">store_type_MA&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">exc_store_align&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">exc_store_adov&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">exc_store_OutOfRange&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">exc_store_timer&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">assign&lt;/span> &lt;span class="n">MA_EXCCode_pip_MA&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">EXCCode_ADEL&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">4&lt;/span>&lt;span class="mi">&amp;#39;d4&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">EXCCode_ADES&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">4&lt;/span>&lt;span class="mi">&amp;#39;d5&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">4&lt;/span>&lt;span class="mi">&amp;#39;d0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="task-3-加入协处理器cp0">Task-3: 加入协处理器CP0
&lt;/h3>&lt;ul>
&lt;li>所有寄存器均为32bits&lt;/li>
&lt;li>处理中断和异常信号，判断是否发出req信号，发出req信号时所有流水寄存器清空（部分信号需要特殊处理）&lt;/li>
&lt;li>eret指令需要清空EXL部分&lt;/li>
&lt;li>0001_0000&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: left">寄存器&lt;/th>
&lt;th>寄存器编号&lt;/th>
&lt;th style="text-align: left">功能域&lt;/th>
&lt;th style="text-align: left">位域&lt;/th>
&lt;th style="text-align: left">解释&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: left">SR（State Register）&lt;/td>
&lt;td>12&lt;/td>
&lt;td style="text-align: left">IM（Interrupt Mask）&lt;/td>
&lt;td style="text-align: left">15:8&lt;/td>
&lt;td style="text-align: left">分别对应六个外部中断，相应位置 1 表示允许中断，置 0 表示禁止中断。这是一个被动的功能，只能通过 &lt;code>mtc0&lt;/code> 这个指令修改，通过修改这个功能域，我们可以屏蔽一些中断。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">SR（State Register）&lt;/td>
&lt;td>12&lt;/td>
&lt;td style="text-align: left">EXL（Exception Level）&lt;/td>
&lt;td style="text-align: left">1&lt;/td>
&lt;td style="text-align: left">任何异常发生时置位，这会强制进入核心态（也就是进入异常处理程序）并禁止中断。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">SR（State Register）&lt;/td>
&lt;td>12&lt;/td>
&lt;td style="text-align: left">IE（Interrupt Enable）&lt;/td>
&lt;td style="text-align: left">0&lt;/td>
&lt;td style="text-align: left">全局中断使能，该位置 1 表示允许中断，置 0 表示禁止中断。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">Cause&lt;/td>
&lt;td>13&lt;/td>
&lt;td style="text-align: left">BD（Branch Delay）&lt;/td>
&lt;td style="text-align: left">31&lt;/td>
&lt;td style="text-align: left">当该位置 1 的时候，EPC 指向当前指令的前一条指令（一定为跳转），否则指向当前指令。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">Cause&lt;/td>
&lt;td>13&lt;/td>
&lt;td style="text-align: left">IP（Interrupt Pending）&lt;/td>
&lt;td style="text-align: left">15:10&lt;/td>
&lt;td style="text-align: left">为 6 位待决的中断位，分别对应 6 个外部中断，相应位置 1 表示有中断，置 0 表示无中断，将会每个周期被修改一次，修改的内容来自计时器和外部中断。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">Cause&lt;/td>
&lt;td>13&lt;/td>
&lt;td style="text-align: left">ExcCode&lt;/td>
&lt;td style="text-align: left">6:2&lt;/td>
&lt;td style="text-align: left">异常编码，记录当前发生的是什么异常。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">EPC&lt;/td>
&lt;td>14&lt;/td>
&lt;td style="text-align: left">-&lt;/td>
&lt;td style="text-align: left">-&lt;/td>
&lt;td style="text-align: left">记录异常处理结束后需要返回的 PC。&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: left">端口&lt;/th>
&lt;th style="text-align: left">方向&lt;/th>
&lt;th style="text-align: left">位数&lt;/th>
&lt;th style="text-align: left">解释&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: left">clk&lt;/td>
&lt;td style="text-align: left">IN&lt;/td>
&lt;td style="text-align: left">1&lt;/td>
&lt;td style="text-align: left">时钟信号。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">reset&lt;/td>
&lt;td style="text-align: left">IN&lt;/td>
&lt;td style="text-align: left">1&lt;/td>
&lt;td style="text-align: left">复位信号。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">en&lt;/td>
&lt;td style="text-align: left">IN&lt;/td>
&lt;td style="text-align: left">1&lt;/td>
&lt;td style="text-align: left">写使能信号。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">CP0Add&lt;/td>
&lt;td style="text-align: left">IN&lt;/td>
&lt;td style="text-align: left">5&lt;/td>
&lt;td style="text-align: left">读取/写入目标寄存器地址。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">CP0In&lt;/td>
&lt;td style="text-align: left">IN&lt;/td>
&lt;td style="text-align: left">32&lt;/td>
&lt;td style="text-align: left">写入寄存器数据。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">CP0Out&lt;/td>
&lt;td style="text-align: left">OUT&lt;/td>
&lt;td style="text-align: left">32&lt;/td>
&lt;td style="text-align: left">读出寄存器数据。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">VPC&lt;/td>
&lt;td style="text-align: left">IN&lt;/td>
&lt;td style="text-align: left">32&lt;/td>
&lt;td style="text-align: left">当前异常中断发生时PC的值。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">BDIn&lt;/td>
&lt;td style="text-align: left">IN&lt;/td>
&lt;td style="text-align: left">1&lt;/td>
&lt;td style="text-align: left">当前异常中断发生指令是否是延迟槽内指令。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">ExcCodeIn&lt;/td>
&lt;td style="text-align: left">IN&lt;/td>
&lt;td style="text-align: left">5&lt;/td>
&lt;td style="text-align: left">当前发生异常类型。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">HWInt&lt;/td>
&lt;td style="text-align: left">IN&lt;/td>
&lt;td style="text-align: left">6&lt;/td>
&lt;td style="text-align: left">外部产生的中断信号。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">EXLClr&lt;/td>
&lt;td style="text-align: left">IN&lt;/td>
&lt;td style="text-align: left">1&lt;/td>
&lt;td style="text-align: left">是否结束异常中断处理（复位 EXL）。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">EPCOut&lt;/td>
&lt;td style="text-align: left">OUT&lt;/td>
&lt;td style="text-align: left">32&lt;/td>
&lt;td style="text-align: left">EPC 的值。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">Req&lt;/td>
&lt;td style="text-align: left">OUT&lt;/td>
&lt;td style="text-align: left">1&lt;/td>
&lt;td style="text-align: left">进入处理程序请求。&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">`define IM regs[12][15:10]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">`define EXL regs[12][1]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">`define IE regs[12][0]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">`define BD regs[13][31]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">`define IP regs[13][15:10]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">`define EXCCode regs[13][6:2]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span> &lt;span class="c1">// SR-12, Cause-13, EPC-14
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">reg&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">regs&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">assign&lt;/span> &lt;span class="n">CP0Out&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">regs&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">CP0Addr&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">IntReq&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">HWInt&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="no">`IM&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="o">!&lt;/span>&lt;span class="no">`EXL&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="no">`IE&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// 允许当前中断 且 不在中断异常中 且 允许中断发生
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">wire&lt;/span> &lt;span class="n">ExcReq&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">EXCCodeIn&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="o">!&lt;/span>&lt;span class="no">`EXL&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// 存在异常 且 不在中断中
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">assign&lt;/span> &lt;span class="n">Req&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">IntReq&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">ExcReq&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">tempEPC&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Req&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">BDIn&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">VPC&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mh">4&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">VPC&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">:&lt;/span> &lt;span class="n">regs&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">14&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">assign&lt;/span> &lt;span class="n">EPCOut&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="n">tempEPC&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">2&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">integer&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">initial&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="mh">32&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">regs&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">always&lt;/span> &lt;span class="p">@(&lt;/span>&lt;span class="k">posedge&lt;/span> &lt;span class="n">clk&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">reset&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="mh">32&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">regs&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="no">`IP&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">HWInt&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">en&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">regs&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">CP0Addr&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">CP0In&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Req&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span> &lt;span class="c1">// int|exc
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="no">`EXCCode&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">IntReq&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="mh">5&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">EXCCodeIn&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="no">`EXL&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="mb">&amp;#39;b1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">regs&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">14&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">tempEPC&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="no">`BD&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">BDIn&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">EXLClr&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="no">`EXL&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="task-4-加指令">Task-4: 加指令
&lt;/h3>&lt;p>在 P6 基础上新增了 &lt;code>mfc0, mtc0, eret, syscall&lt;/code> 四条新指令&lt;/p>
&lt;p>目前p7要求实现如下指令：(最好把jump指令也实现了，方便处理异常)&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nop, add, sub, and, or, slt, sltu, lui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">addi, andi, ori
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lb, lh, lw, sb, sh, sw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mult, multu, div, divu, mfhi, mflo, mthi, mtlo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">beq, bne, jal, jr,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mfc0, mtc0, eret, syscall
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="mfc0">MFC0
&lt;/h4>&lt;p>把CP0中的rd号寄存器的值存入grf的rt寄存器&lt;/p>
&lt;ul>
&lt;li>需要简单处理下转发，类似lw的转发&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://lhy0424.top/p/co_p7/mfc0.png"
width="838"
height="622"
srcset="https://lhy0424.top/p/co_p7/mfc0_hu_50ab437d1654dc62.png 480w, https://lhy0424.top/p/co_p7/mfc0_hu_9c51af34e0fe2e67.png 1024w"
loading="lazy"
alt="mfc0"
class="gallery-image"
data-flex-grow="134"
data-flex-basis="323px"
>&lt;/p>
&lt;h4 id="mtc0">MTC0
&lt;/h4>&lt;p>将grf的rt号寄存器的值存入CP0的rd号寄存器&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/co_p7/mtc0.png"
width="836"
height="642"
srcset="https://lhy0424.top/p/co_p7/mtc0_hu_ab07cb8471ce8106.png 480w, https://lhy0424.top/p/co_p7/mtc0_hu_83136521f18a4ef5.png 1024w"
loading="lazy"
alt="mtc0"
class="gallery-image"
data-flex-grow="130"
data-flex-basis="312px"
>&lt;/p>
&lt;h4 id="eret">ERET
&lt;/h4>&lt;p>从错误处理程序中返回到主程序&lt;/p>
&lt;ul>
&lt;li>在ID级时设置next_pc为CP0的EXC&lt;/li>
&lt;li>在ID级时清空延迟槽，确保后续指令不会被处理&lt;/li>
&lt;li>到达MA级时，需要清空CP0的EXL部分，表示当前不在处于核心状态（异常处理程序）&lt;/li>
&lt;li>在ID级时，如果EX或MA级是MTC0且目标寄存器为14号（EXC）则阻塞，确保返回地址正确。&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://lhy0424.top/p/co_p7/eret.png"
width="866"
height="682"
srcset="https://lhy0424.top/p/co_p7/eret_hu_1e53b4866b3d2ee4.png 480w, https://lhy0424.top/p/co_p7/eret_hu_7c33f88c193f7d6e.png 1024w"
loading="lazy"
alt="eret"
class="gallery-image"
data-flex-grow="126"
data-flex-basis="304px"
>&lt;/p>
&lt;h4 id="syscall">syscall
&lt;/h4>&lt;p>在controller里发出一个异常信号（异常码为8）即可&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/co_p7/syscall.png"
width="879"
height="616"
srcset="https://lhy0424.top/p/co_p7/syscall_hu_773486bcb530b1fb.png 480w, https://lhy0424.top/p/co_p7/syscall_hu_ee3870c9a69b286a.png 1024w"
loading="lazy"
alt="syscall"
class="gallery-image"
data-flex-grow="142"
data-flex-basis="342px"
>&lt;/p>
&lt;h3 id="流水寄存器行为">流水寄存器行为
&lt;/h3>&lt;h4 id="为什么要修改寄存器的清空行为">为什么要修改寄存器的清空行为？
&lt;/h4>&lt;p>我们在阻塞的时候会在EX级产生一个bubble，可以看作nop不发生任何作用，但实际上我们要把CPU封装为单周期CPU，级两条相邻的指令之间不会莫名其妙多出来一个nop指令。&lt;/p>
&lt;p>试想，如果不修改清空逻辑的情况下，ID级是一个延迟槽内的指令，正常来说它到达MA级时如果发生了异常或中断，我们的EPC是需要写入PC-4的，因为我们从异常处理程序中返回时需要返回到延迟槽指令的前一条指令（即跳转指令）。而如果延迟槽内的指令在ID级时发生了阻塞产生了一个&amp;rsquo;nop&amp;rsquo;，nop流水到MA级时发生了异常或中断我们该如何记录EPC？这个&amp;rsquo;nop&amp;rsquo;在外部看来是不应该存在的，其没有对应的PC，其对应的PC应该是延迟槽指令的PC，其也应该被标记为延迟槽内指令，这样从异常处理程序中返回时才能返回到正确的地址。&lt;/p>
&lt;p>按照从上至下的优先级依次处理&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>信号&lt;/th>
&lt;th>PC流水寄存器行为&lt;/th>
&lt;th>BD流水寄存器行为&lt;/th>
&lt;th>其他流水寄存器行为&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>reset&lt;/code>&lt;/td>
&lt;td>复位至 &lt;code>0x00003000&lt;/code>&lt;/td>
&lt;td>复位至 &lt;code>0&lt;/code>&lt;/td>
&lt;td>清空&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>req&lt;/code>&lt;/td>
&lt;td>设置为 &lt;code>0x00004180&lt;/code>&lt;/td>
&lt;td>设置为 &lt;code>0&lt;/code>&lt;/td>
&lt;td>清空&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ID_EXLClr&lt;/code> （仅对F级到D级流水寄存器起作用，&lt;strong>且此时stall信号为0&lt;/strong>）&lt;/td>
&lt;td>设置为当前周期的 &lt;code>EPC&lt;/code> 的值&lt;/td>
&lt;td>不发生变化&lt;/td>
&lt;td>清空&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>flush&lt;/code>（仅指对D级到E级流水寄存器起作用的阻塞信号）&lt;/td>
&lt;td>不发生变化&lt;/td>
&lt;td>不发生变化&lt;/td>
&lt;td>清空&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="pc">PC
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="k">always&lt;/span> &lt;span class="p">@(&lt;/span>&lt;span class="k">posedge&lt;/span> &lt;span class="n">clk&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">reset&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">req&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pc&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">req&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">32&amp;#39;h4180&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mh">32&amp;#39;h3000&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">en&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pc&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">next_pc&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="if_id-reg">IF_ID Reg
&lt;/h4>&lt;p>clear_bd表示清空延迟槽，对于P7仅针对eret指令&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="k">always&lt;/span> &lt;span class="p">@(&lt;/span>&lt;span class="k">posedge&lt;/span> &lt;span class="n">clk&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">reset&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">clr&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">req&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">clear_bd&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//置0操作省略
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">pc_add4_out&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">reset&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">32&amp;#39;h00003004&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">req&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">32&amp;#39;h00004184&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">clear_bd&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">EPC:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BD_out&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">clear_bd&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">BD:&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">en&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//省略
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="id_ex-reg">ID_EX Reg
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="k">always&lt;/span> &lt;span class="p">@(&lt;/span>&lt;span class="k">posedge&lt;/span> &lt;span class="n">clk&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">reset&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">stall&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">req&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//置0操作省略
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">pc_add4_out&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">reset&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">32&amp;#39;h00003004&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">req&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">32&amp;#39;h00004184&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">stall&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">pc_add4:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BD_out&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">stall&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">BD:&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">en&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//省略
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="ex_ma-reg">EX_MA Reg
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="k">always&lt;/span> &lt;span class="p">@(&lt;/span>&lt;span class="k">posedge&lt;/span> &lt;span class="n">clk&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">reset&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">clr&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">req&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//置0操作省略
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">pc_add4_out&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">reset&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">32&amp;#39;h00003004&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">req&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">32&amp;#39;h00004184&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">en&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//省略
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="ma_wb-reg">MA_WB Reg
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="k">always&lt;/span> &lt;span class="p">@(&lt;/span>&lt;span class="k">posedge&lt;/span> &lt;span class="n">clk&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">clr&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">reset&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">req&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//置0操作省略
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">pc_add4_out&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">reset&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">32&amp;#39;h00003004&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">req&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">32&amp;#39;h00004184&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">en&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//省略
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="我的bug">我的Bug
&lt;/h2>&lt;p>以下是我在通过课下弱测和中测后发现的bug：&lt;/p>
&lt;ul>
&lt;li>不涉及计算操作时ALUOP默认设为了`ADD，导致不是ALU类指令时出现了溢出情况。&lt;/li>
&lt;li>当MA级异常时，如果EX级为mthi或mtlo时仍会向HI或LO中写入值。&lt;/li>
&lt;li>当PC错误或遇到未知指令时没有向后传递nop。&lt;/li>
&lt;li>mtc0位于MA级时，如果当出现中断时，仍会向CP0中的寄存器写入值。&lt;/li>
&lt;li>EXCCode优先级问题。load或store指令会触发EX级的算术overflow（异常码12）异常，在MA级也会除法overflow（异常码4或5）的异常，按照&lt;code>优先处理先探查到的错误&lt;/code>的原则我们会选择EX级的算术overflow，导致存入CP0的异常码错误。&lt;/li>
&lt;/ul>
&lt;h2 id="测试方案">测试方案
&lt;/h2>&lt;ul>
&lt;li>手动构造样例确保新指令的功能正确性，尽可能覆盖大部分异常情况。&lt;/li>
&lt;li>随机生成指令强测确保转发和阻塞的正确性。对CO-Killer略加修改，生成符合要求的随机数据。&lt;/li>
&lt;li>限制读写寄存器的范围，能够尽可能多的造成数据冒险，再加上大量随机数据，基本可以覆盖全部转发和阻塞情况。&lt;/li>
&lt;li>利用自己写的python脚本填充nop至0x4180。&lt;/li>
&lt;li>定时器产生周期性中断信号，测试timer的中断是否正确被处理。&lt;/li>
&lt;li>修改testbench产生中断，测试中断发生器发出的中断是否正确被处理。&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 填充nop&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">last_pc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">input&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;enter the last pc in text: &amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">int&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">last_pc&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">16&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">while&lt;/span> &lt;span class="n">pc&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mh">0x4180&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;# &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="nb">hex&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pc&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">nop&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pc&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">4&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="思考题">思考题
&lt;/h2>&lt;ol>
&lt;li>请查阅相关资料，说明鼠标和键盘的输入信号是如何被 CPU 知晓的？&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>鼠标和键盘产生中断信号，进入中断处理区的对应位置，将输入信号从鼠标和键盘中读入寄存器。&lt;/p>&lt;/blockquote>
&lt;ol start="2">
&lt;li>请思考为什么我们的 CPU 处理中断异常必须是已经指定好的地址？如果你的 CPU 支持用户自定义入口地址，即处理中断异常的程序由用户提供，其还能提供我们所希望的功能吗？如果可以，请说明这样可能会出现什么问题？否则举例说明。（假设用户提供的中断处理程序合法）&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;ul>
&lt;li>指定好的中断处理入口地址由硬件设计决定，能确保所有中断和异常按照既定逻辑处理。如果允许用户自定义入口地址，用户可能会直接跳过关键的上下文保存步骤，导致程序状态紊乱&lt;/li>
&lt;li>指定的中断地址通常位于受保护的系统区域，由操作系统或固件控制。用户故意定义有害的中断处理程序，例如窃取敏感信息或修改关键数据。&lt;/li>
&lt;/ul>&lt;/blockquote>
&lt;ol start="3">
&lt;li>为何与外设通信需要 Bridge？&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;ul>
&lt;li>CPU与外设数据吞吐量存在差异：Bridge充当缓冲区和速率匹配器，协调高速的处理器与低速外设之间的数据交换。&lt;/li>
&lt;li>地址映射差异：Bridge可以对地址进行解码，将处理器的访问请求转化为外设能够理解的操作。&lt;/li>
&lt;/ul>&lt;/blockquote>
&lt;ol start="4">
&lt;li>请阅读官方提供的定时器源代码，阐述两种中断模式的异同，并针对每一种模式绘制状态移图。&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>&lt;strong>MODE 0&lt;/strong>&lt;/p>
&lt;p>定时产生中断信号&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/co_p7/timer_mode0.png"
width="401"
height="328"
srcset="https://lhy0424.top/p/co_p7/timer_mode0_hu_a1acf249ce3603c1.png 480w, https://lhy0424.top/p/co_p7/timer_mode0_hu_eb0ef2b2f46f6d2d.png 1024w"
loading="lazy"
alt="timer_mode0"
class="gallery-image"
data-flex-grow="122"
data-flex-basis="293px"
>&lt;/p>
&lt;p>&lt;strong>MODE 1&lt;/strong>&lt;/p>
&lt;p>周期性产生中断信号&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/co_p7/timer_mode1.png"
width="401"
height="328"
srcset="https://lhy0424.top/p/co_p7/timer_mode1_hu_41c645421cf1b3fd.png 480w, https://lhy0424.top/p/co_p7/timer_mode1_hu_dfd9c5c6476abdc8.png 1024w"
loading="lazy"
alt="timer_mode1"
class="gallery-image"
data-flex-grow="122"
data-flex-basis="293px"
>&lt;/p>&lt;/blockquote>
&lt;ol start="5">
&lt;li>倘若中断信号流入的时候，在检测宏观 PC 的一级如果是一条空泡（你的 CPU 该级所有信息均为空）指令，此时会发生什么问题？在此例基础上请思考：在 P7 中，清空流水线产生的空泡指令应该保留原指令的哪些信息？&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>如果此时有一个中断或异常信号，则CP0记录下的PC为0x0000，在从异常处理程序返回时会发生错误。&lt;/p>
&lt;p>应该保留PC值，由于在Req信号有效时，通过将流水寄存器的PC值不进行复位，使得达到精确异常的效果。使得回到EPC时依然是精确的。&lt;/p>&lt;/blockquote>
&lt;ol start="6">
&lt;li>为什么 &lt;code>jalr&lt;/code> 指令为什么不能写成 &lt;code>jalr $31, $31&lt;/code>？&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>如果 &lt;code>jalr $31 $31 &lt;/code>的延迟槽内发生异常或需要响应中断。那么 &lt;code>$31&lt;/code> 寄存器的值已经被 &lt;code>jalr&lt;/code> 改变，但是处理异常结束后，会再次执行 &lt;code>jalr&lt;/code> 指令，这就会跳转到不正确的 &lt;code>PC&lt;/code> 地址。&lt;/p>&lt;/blockquote>
&lt;ol start="7">
&lt;li>[P7 选做] 请详细描述你的测试方案及测试数据构造策略。&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>见上文&lt;/p>&lt;/blockquote>
&lt;h2 id="课程组官方testbench">课程组官方TestBench
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl">&lt;span class="no">`timescale&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="n">ns&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="n">ps&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">module&lt;/span> &lt;span class="n">mips_txt&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">reg&lt;/span> &lt;span class="n">clk&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">reg&lt;/span> &lt;span class="n">reset&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">reg&lt;/span> &lt;span class="n">interrupt&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">macroscopic_pc&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">i_inst_addr&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">i_inst_rdata&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">m_data_addr&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">m_data_rdata&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">m_data_wdata&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">3&lt;/span> &lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">m_data_byteen&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">m_int_addr&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">3&lt;/span> &lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">m_int_byteen&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">m_inst_addr&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">w_grf_we&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">4&lt;/span> &lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">w_grf_addr&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">w_grf_wdata&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">w_inst_addr&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mips&lt;/span> &lt;span class="n">uut&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">clk&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">clk&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">reset&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">reset&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">interrupt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">interrupt&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">macroscopic_pc&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">macroscopic_pc&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">i_inst_addr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i_inst_addr&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">i_inst_rdata&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i_inst_rdata&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">m_data_addr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m_data_addr&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">m_data_rdata&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m_data_rdata&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">m_data_wdata&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m_data_wdata&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">m_data_byteen&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m_data_byteen&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">m_int_addr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m_int_addr&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">m_int_byteen&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m_int_byteen&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">m_inst_addr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m_inst_addr&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">w_grf_we&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">w_grf_we&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">w_grf_addr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">w_grf_addr&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">w_grf_wdata&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">w_grf_wdata&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">w_inst_addr&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">w_inst_addr&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">initial&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">clk&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reset&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">interrupt&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">#&lt;/span>&lt;span class="mh">20&lt;/span> &lt;span class="n">reset&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">integer&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">reg&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">fixed_addr&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">reg&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">fixed_wdata&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">reg&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">4095&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">reg&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">inst&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">5119&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ----------- For Instructions -----------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">assign&lt;/span> &lt;span class="n">m_data_rdata&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">[(&lt;/span>&lt;span class="n">m_data_addr&lt;/span> &lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="mh">5120&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">assign&lt;/span> &lt;span class="n">i_inst_rdata&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">inst&lt;/span>&lt;span class="p">[((&lt;/span>&lt;span class="n">i_inst_addr&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mh">32&amp;#39;h3000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="mh">5120&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">initial&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">$readmemh&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;code.txt&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">inst&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mh">5120&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ----------- For Data Memory -----------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">always&lt;/span> &lt;span class="p">@(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fixed_wdata&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">[(&lt;/span>&lt;span class="n">m_data_addr&lt;/span> &lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="mh">4095&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fixed_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">m_data_addr&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="mh">32&amp;#39;hfffffffc&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">m_data_byteen&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">3&lt;/span>&lt;span class="p">])&lt;/span> &lt;span class="n">fixed_wdata&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">24&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">m_data_wdata&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">24&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">m_data_byteen&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">2&lt;/span>&lt;span class="p">])&lt;/span> &lt;span class="n">fixed_wdata&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">23&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">16&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">m_data_wdata&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">23&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">16&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">m_data_byteen&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="p">])&lt;/span> &lt;span class="n">fixed_wdata&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">15&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mh">8&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">m_data_wdata&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">15&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mh">8&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">m_data_byteen&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">])&lt;/span> &lt;span class="n">fixed_wdata&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">7&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">m_data_wdata&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">7&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">always&lt;/span> &lt;span class="p">@(&lt;/span>&lt;span class="k">posedge&lt;/span> &lt;span class="n">clk&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">reset&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mh">4096&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">m_data_byteen&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">fixed_addr&lt;/span> &lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="mh">2&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mh">4096&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">data&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">fixed_addr&lt;/span> &lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">fixed_wdata&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">$display&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%d@%h: *%h &amp;lt;= %h&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">$time&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">m_inst_addr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">fixed_addr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">fixed_wdata&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ----------- For Registers -----------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">always&lt;/span> &lt;span class="p">@(&lt;/span>&lt;span class="k">posedge&lt;/span> &lt;span class="n">clk&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">~&lt;/span>&lt;span class="n">reset&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">w_grf_we&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">w_grf_addr&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">$display&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%d@%h: $%d &amp;lt;= %h&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">$time&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">w_inst_addr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">w_grf_addr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">w_grf_wdata&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ----------- For Interrupt -----------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">fixed_macroscopic_pc&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">assign&lt;/span> &lt;span class="n">fixed_macroscopic_pc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">macroscopic_pc&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="mh">32&amp;#39;hfffffffc&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">parameter&lt;/span> &lt;span class="n">target_pc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">32&amp;#39;h00003010&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">integer&lt;/span> &lt;span class="n">count&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">initial&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">always&lt;/span> &lt;span class="p">@(&lt;/span>&lt;span class="k">negedge&lt;/span> &lt;span class="n">clk&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">reset&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">interrupt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">interrupt&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="n">m_int_byteen&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">m_int_addr&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="mh">32&amp;#39;hfffffffc&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">32&amp;#39;h7f20&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">interrupt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">fixed_macroscopic_pc&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">target_pc&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">count&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">interrupt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">always&lt;/span> &lt;span class="p">#&lt;/span>&lt;span class="mh">2&lt;/span> &lt;span class="n">clk&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="n">clk&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">endmodule&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>P6_设计文档</title><link>https://lhy0424.top/p/co_p6/</link><pubDate>Tue, 10 Dec 2024 22:26:00 +0000</pubDate><guid>https://lhy0424.top/p/co_p6/</guid><description>&lt;img src="https://lhy0424.top/p/co_p6/P6_cover.jpg" alt="Featured image of post P6_设计文档" />&lt;h1 id="p6_document">P6_document
&lt;/h1>&lt;h2 id="hazardv">Hazard.v
&lt;/h2>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>input&lt;/th>
&lt;th>explain&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Instr_ID&lt;/td>
&lt;td>ID阶段的指令码&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Instr_EX&lt;/td>
&lt;td>EX阶段的指令码&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Instr_MA&lt;/td>
&lt;td>MA阶段的指令码&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>A3_EX&lt;/td>
&lt;td>EX阶段的寄存器写入地址&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>A3_MA&lt;/td>
&lt;td>MA阶段的寄存器写入地址&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>busy&lt;/td>
&lt;td>乘除槽正在进行计算&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>start&lt;/td>
&lt;td>乘除槽开始进行计算&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="t_use表格需求者">T_use表格（需求者）
&lt;/h4>&lt;p>指令位于ID级时，还需要多少个周期才必须要使用数据。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>add&lt;/th>
&lt;th>sub&lt;/th>
&lt;th>ori&lt;/th>
&lt;th>lw&lt;/th>
&lt;th>sw&lt;/th>
&lt;th>beq&lt;/th>
&lt;th>lui&lt;/th>
&lt;th>jal&lt;/th>
&lt;th>jr&lt;/th>
&lt;th>nop&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>$T_{use}(rs)$&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;td>1&lt;/td>
&lt;td>&lt;/td>
&lt;td>0&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>$T_{use}(rt)$&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>2&lt;/td>
&lt;td>0&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>P6_new&lt;/th>
&lt;th>and&lt;/th>
&lt;th>or&lt;/th>
&lt;th>slt&lt;/th>
&lt;th>sltu&lt;/th>
&lt;th>addi&lt;/th>
&lt;th>andi&lt;/th>
&lt;th>lb&lt;/th>
&lt;th>lh&lt;/th>
&lt;th>sb&lt;/th>
&lt;th>sh&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>$T_{use}(rs)$&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>$T_{use}(rt)$&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>2&lt;/td>
&lt;td>2&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>P6_new&lt;/th>
&lt;th>mult&lt;/th>
&lt;th>multu&lt;/th>
&lt;th>div&lt;/th>
&lt;th>divu&lt;/th>
&lt;th>mfhi&lt;/th>
&lt;th>mflo&lt;/th>
&lt;th>mthi&lt;/th>
&lt;th>mtlo&lt;/th>
&lt;th>bne&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>$T_{use}(rs)$&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>$T_{use}(rt)$&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>0&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">Tuse_rs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">add_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">sub_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">ori_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">lw_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">sw_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">lui_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">and_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">or_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">slt_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">sltu_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">addi_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">andi_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">lb_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">lh_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">sb_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">sh_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">mthi_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">mtlo_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">mult_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">multu_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">div_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">divu_ID&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b01&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">beq_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">jr_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">bne_ID&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b11&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">Tuse_rt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">add_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">sub_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">and_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">or_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">slt_ID&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">sltu_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">mult_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">multu_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">div_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">divu_ID&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b01&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">sw_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">sb_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">sh_ID&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b10&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">beq_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">bne_ID&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b11&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="t_new表格供给者">T_new表格（供给者）
&lt;/h4>&lt;p>T_new: 供给指令位于某个流水级时还需要多少个周期才可以计算出结果并存储到流水寄存器中。&lt;/p>
&lt;p>&lt;em>&lt;strong>早于需求指令进入流水线的供给者还需要多少cycle能够产生需求者需要的寄存器值。&lt;/strong>&lt;/em>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Intsr&lt;/th>
&lt;th>add&lt;/th>
&lt;th>sub&lt;/th>
&lt;th>ori&lt;/th>
&lt;th>lw&lt;/th>
&lt;th>sw&lt;/th>
&lt;th>beq&lt;/th>
&lt;th>lui&lt;/th>
&lt;th>jal&lt;/th>
&lt;th>jr&lt;/th>
&lt;th>nop&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>功能部件(结果来源)&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>DM&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>PC&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>EX&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>2&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>MA&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>1&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>0&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>WB&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>0&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>0&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>P6_new_Intsr&lt;/th>
&lt;th>and&lt;/th>
&lt;th>or&lt;/th>
&lt;th>slt&lt;/th>
&lt;th>sltu&lt;/th>
&lt;th>addi&lt;/th>
&lt;th>andi&lt;/th>
&lt;th>lb&lt;/th>
&lt;th>lh&lt;/th>
&lt;th>sb&lt;/th>
&lt;th>sh&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>功能部件(结果来源)&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>DM&lt;/td>
&lt;td>DM&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>EX&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>2&lt;/td>
&lt;td>2&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>MA&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>WB&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>P6_new_Intsr&lt;/th>
&lt;th>mult&lt;/th>
&lt;th>multu&lt;/th>
&lt;th>div&lt;/th>
&lt;th>divu&lt;/th>
&lt;th>mfhi&lt;/th>
&lt;th>mflo&lt;/th>
&lt;th>mthi&lt;/th>
&lt;th>mtlo&lt;/th>
&lt;th>bne&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>功能部件(结果来源)&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>mdb&lt;/td>
&lt;td>mdb&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>EX&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>MA&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>WB&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">Tnew_EX&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">add_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">sub_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">ori_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">lui_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">and_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">or_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">slt_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">sltu_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">addi_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">andi_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">mfhi_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">mflo_EX&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b01&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">lw_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">lb_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">lh_EX&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b10&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">Tnew_MA&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">lw_MA&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">lb_MA&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">lh_MA&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b01&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="rs策略矩阵">rs策略矩阵
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>$T_{use} \textbackslash \space T_{new}$&lt;/th>
&lt;th>EX&lt;/th>
&lt;th>EX&lt;/th>
&lt;th>EX&lt;/th>
&lt;th>MA&lt;/th>
&lt;th>MA&lt;/th>
&lt;th>MA&lt;/th>
&lt;th>WB&lt;/th>
&lt;th>WB&lt;/th>
&lt;th>WB&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>DM&lt;/td>
&lt;td>PC&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>DM&lt;/td>
&lt;td>PC&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>DM&lt;/td>
&lt;td>PC&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>1&lt;/td>
&lt;td>2&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>0&lt;/td>
&lt;td>&lt;strong>S&lt;/strong>&lt;/td>
&lt;td>&lt;strong>S&lt;/strong>&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>&lt;strong>S&lt;/strong>&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>1&lt;/td>
&lt;td>F&lt;/td>
&lt;td>&lt;strong>S&lt;/strong>&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="rt策略矩阵">rt策略矩阵
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>$T_{use} \textbackslash \space T_{new}$&lt;/th>
&lt;th>EX&lt;/th>
&lt;th>EX&lt;/th>
&lt;th>EX&lt;/th>
&lt;th>MA&lt;/th>
&lt;th>MA&lt;/th>
&lt;th>MA&lt;/th>
&lt;th>WB&lt;/th>
&lt;th>WB&lt;/th>
&lt;th>WB&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>DM&lt;/td>
&lt;td>PC&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>DM&lt;/td>
&lt;td>PC&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>DM&lt;/td>
&lt;td>PC&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>1&lt;/td>
&lt;td>2&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>0&lt;/td>
&lt;td>&lt;strong>S&lt;/strong>&lt;/td>
&lt;td>&lt;strong>S&lt;/strong>&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>&lt;strong>S&lt;/strong>&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>1&lt;/td>
&lt;td>F&lt;/td>
&lt;td>&lt;strong>S&lt;/strong>&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="如何理解策略矩阵">如何理解策略矩阵
&lt;/h3>&lt;ul>
&lt;li>策略矩阵针对的是AT法中的Time部分，具体判断阻塞还是转发需要综合Adress部分&lt;/li>
&lt;li>对于ALU型指令，如add，只需要关注 $T_{new}$ 的ALU一列，其表示在当前流水级下，还有多少周期才能计算出结果并存入流水级寄存器。&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">Stall_RS_EX&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Tuse_rs&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">Tnew_EX&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">RS_ID&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">RS_ID&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">Stall_RS_MA&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Tuse_rs&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">Tnew_MA&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">RS_ID&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">RS_ID&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">Stall_RT_EX&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Tuse_rt&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">Tnew_EX&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">RT_ID&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">RT_ID&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">Stall_RT_MA&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Tuse_rt&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">Tnew_MA&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">RT_ID&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">RT_ID&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">Stall_md&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">busy&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">mult_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">multu_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">div_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">divu_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">mfhi_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">mflo_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">mthi_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">mtlo_ID&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">assign&lt;/span> &lt;span class="n">Stall&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Stall_RS_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">Stall_RS_MA&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">Stall_RT_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">Stall_RT_MA&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">Stall_md&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="forward-in-mipsv">Forward in mips.v
&lt;/h2>&lt;h4 id="数据的供给者">数据的供给者
&lt;/h4>&lt;ul>
&lt;li>EX_MA级流水线寄存器&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">forward_EX_MA&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">RegWrite_MA&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Mem2Reg_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">ALU_C_MA:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">RegWrite_MA&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Mem2Reg_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b10&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="n">pc_add4_MA&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">32&lt;/span>&lt;span class="mi">&amp;#39;d4&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">32&amp;#39;h404&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>MA_WB级流水线寄存器&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="k">assign&lt;/span> &lt;span class="n">grf_WD&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Mem2Reg_WB&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">ALU_C_WB&lt;/span> &lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">Mem2Reg_WB&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b01&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">dm_data_WB&lt;/span> &lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">Mem2Reg_WB&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b10&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">pc_add4_WB&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">32&lt;/span>&lt;span class="mi">&amp;#39;d4&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="mh">32&lt;/span>&lt;span class="mi">&amp;#39;d0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">forward_MA_WB&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RegWrite_WB&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">grf_WD:&lt;/span> &lt;span class="mh">32&amp;#39;h405&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="数据需求者">数据需求者
&lt;/h4>&lt;ul>
&lt;li>ID级&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">RD1_ID_valid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">RS_ID&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">A3_MA&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_MA&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">5&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">forward_EX_MA:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">((&lt;/span>&lt;span class="n">RS_ID&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">A3_WB&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_WB&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">5&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">forward_MA_WB:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RD1_ID&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">RD2_ID_valid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">RT_ID&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">A3_MA&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_MA&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">5&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">forward_EX_MA:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">((&lt;/span>&lt;span class="n">RT_ID&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">A3_WB&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_WB&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">5&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">forward_MA_WB:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RD2_ID&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>EX级&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//forward--select valid ALU_A and ALU_B
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">ALU_A_EX_valid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">RS_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">A3_MA&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_MA&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">5&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">forward_EX_MA:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">((&lt;/span>&lt;span class="n">RS_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">A3_WB&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_WB&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">5&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">forward_MA_WB:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RD1_EX&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">Grt_EX_valid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">RT_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">A3_MA&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_MA&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">5&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">forward_EX_MA:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">((&lt;/span>&lt;span class="n">RT_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">A3_WB&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_WB&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">5&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">forward_MA_WB:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RD2_EX&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="c1">//将目前正确的Grt值，流水到MA级供sw指令使用，也可供R-type-ALU指令使用
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">Grt_MA_valid&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">ALU_B_EX_valid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">ALUSrc_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="nl">Grt_EX_valid:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">ALUSrc_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="mb">&amp;#39;b1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">ext32_EX&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="mh">32&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>MA级&lt;/p>
&lt;p>再一次获取转发数据，确保DM中的Grt值是正确的&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">Grt_MA_valid_valid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">RT_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">A3_WB&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_WB&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">5&lt;/span>&lt;span class="mi">&amp;#39;d0&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">forward_MA_WB:&lt;/span> &lt;span class="n">Grt_MA_valid&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="流水线寄存器">流水线寄存器
&lt;/h2>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>PC&lt;/th>
&lt;th>IF_ID&lt;/th>
&lt;th>ID_EX&lt;/th>
&lt;th>EX_MA&lt;/th>
&lt;th>MA_WB&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>en&lt;/td>
&lt;td>nStall&lt;/td>
&lt;td>nStall&lt;/td>
&lt;td>true&lt;/td>
&lt;td>false&lt;/td>
&lt;td>true&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>clr&lt;/td>
&lt;td>null&lt;/td>
&lt;td>false&lt;/td>
&lt;td>Stall&lt;/td>
&lt;td>true&lt;/td>
&lt;td>false&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>RegDst&lt;/th>
&lt;th>ExtOp&lt;/th>
&lt;th>jump&lt;/th>
&lt;th>jumpSrc&lt;/th>
&lt;th>branch&lt;/th>
&lt;th>bOp&lt;/th>
&lt;th>ALUSrc&lt;/th>
&lt;th>ALUOP&lt;/th>
&lt;th>mdOp&lt;/th>
&lt;th>load_type&lt;/th>
&lt;th>store_type&lt;/th>
&lt;th>MemWrite&lt;/th>
&lt;th>Mem2Reg&lt;/th>
&lt;th>RegWrite&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>作用阶段&lt;/td>
&lt;td>EX&lt;/td>
&lt;td>ID&lt;/td>
&lt;td>ID&lt;/td>
&lt;td>ID&lt;/td>
&lt;td>ID&lt;/td>
&lt;td>ID&lt;/td>
&lt;td>EX&lt;/td>
&lt;td>EX&lt;/td>
&lt;td>EX&lt;/td>
&lt;td>MA&lt;/td>
&lt;td>MA&lt;/td>
&lt;td>MA&lt;/td>
&lt;td>WB&lt;/td>
&lt;td>WB&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>IF_ID&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ID_EX&lt;/td>
&lt;td>1&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>EX_MA&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>MA_WB&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="stall-explain">Stall Explain
&lt;/h4>&lt;p>ID级指令静止，EX级插入一个nop&lt;/p>
&lt;ul>
&lt;li>PC不写入新数据&lt;/li>
&lt;li>IF_ID寄存器不写入新数据&lt;/li>
&lt;li>ID_EX寄存器清零，即插入nop(0x00000000)&lt;/li>
&lt;/ul>
&lt;h4 id="logic">Logic
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl">&lt;span class="k">module&lt;/span> &lt;span class="n">Stage_Reg&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">input&lt;/span> &lt;span class="n">clk&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">input&lt;/span> &lt;span class="n">reset&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">input&lt;/span> &lt;span class="n">en&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">input&lt;/span> &lt;span class="n">clr&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">input&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">output&lt;/span> &lt;span class="kt">reg&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">data_out&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">initial&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">data_out&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">always&lt;/span> &lt;span class="p">@(&lt;/span>&lt;span class="k">posedge&lt;/span> &lt;span class="n">clk&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">reset&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">clr&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">data_out&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">en&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">data_out&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="信号解释">信号解释
&lt;/h2>&lt;h4 id="jumpsrc-2-bit">jumpSrc (2-bit)
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>jumpSrc&lt;/th>
&lt;th>type&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>2&amp;rsquo;b00&lt;/td>
&lt;td>branch&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&amp;rsquo;b01&lt;/td>
&lt;td>jump&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&amp;rsquo;b10&lt;/td>
&lt;td>jr&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl">&lt;span class="k">assign&lt;/span> &lt;span class="n">next_pc_ID&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">jumpSrc_ID&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="nl">branch_offset_ID:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">jumpSrc_ID&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b01&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="nl">jumpExt32_ID:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">jumpSrc_ID&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b10&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="nl">RD1_ID_valid:&lt;/span> &lt;span class="mh">32&amp;#39;h404&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="mem2reg-2-bit">Mem2Reg (2-bit)
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Mem2Reg&lt;/th>
&lt;th>type&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>2‘b00&lt;/td>
&lt;td>ALU&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&amp;rsquo;b01&lt;/td>
&lt;td>lw&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&amp;rsquo;b10&lt;/td>
&lt;td>link&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl">&lt;span class="k">assign&lt;/span> &lt;span class="n">grf_WD&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Mem2Reg_WB&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">ALU_C_WB&lt;/span> &lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">Mem2Reg_WB&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b01&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">dm_data_WB&lt;/span> &lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">Mem2Reg_WB&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b10&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">pc_add4_WB&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">32&lt;/span>&lt;span class="mi">&amp;#39;d4&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="mh">32&lt;/span>&lt;span class="mi">&amp;#39;d0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="regdst-2-bit">RegDst (2-bit)
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>RegDst&lt;/th>
&lt;th>type&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>2&amp;rsquo;b00&lt;/td>
&lt;td>无需写入寄存器的指令&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&amp;rsquo;b01&lt;/td>
&lt;td>R-type，写入rd寄存器&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&amp;rsquo;b10&lt;/td>
&lt;td>I-type，写入rt寄存器&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&amp;rsquo;b11&lt;/td>
&lt;td>link，写入$ra ($31)&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl">&lt;span class="k">assign&lt;/span> &lt;span class="n">A3_EX&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">RegDst_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">5&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="c1">//null
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">RegDst_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b01&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">RD_EX:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">RegDst_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b10&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">RT_EX:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">RegDst_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b11&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">5&amp;#39;h1f&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">5&lt;/span>&lt;span class="mb">&amp;#39;b00000&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="aluop-4-bit">ALUOp (4-bit)
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>ALUOp&lt;/th>
&lt;th>type&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>4&amp;rsquo;b0000&lt;/td>
&lt;td>add&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4&amp;rsquo;b0001&lt;/td>
&lt;td>sub&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4&amp;rsquo;b0010&lt;/td>
&lt;td>or&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4&amp;rsquo;b0011&lt;/td>
&lt;td>lui&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4&amp;rsquo;b0100&lt;/td>
&lt;td>and&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4&amp;rsquo;b0101&lt;/td>
&lt;td>slt&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4&amp;rsquo;b0110&lt;/td>
&lt;td>sltu&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4&amp;rsquo;b0111&lt;/td>
&lt;td>addi&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">32&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">A_ext&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">32&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">B_ext&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">32&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">temp&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">A_ext&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">B_ext&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">always&lt;/span> &lt;span class="p">@(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="no">`ADD&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">B&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="no">`ADDI&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">temp&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">32&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">temp&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="n">temp&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">32&lt;/span>&lt;span class="mi">&amp;#39;d0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="no">`SUB&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">B&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="no">`OR&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">B&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="no">`SL16&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="mh">16&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="no">`AND&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">B&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="no">`SLT&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">$signed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">$signed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">32&lt;/span>&lt;span class="mb">&amp;#39;b1&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mh">32&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="no">`SLTU&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">B&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">32&lt;/span>&lt;span class="mb">&amp;#39;b1&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mh">32&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">default&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="n">C&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">endcase&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="mdop-4-bit">mdOp (4-bit)
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>mdOp&lt;/th>
&lt;th>type&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>4&amp;rsquo;b0001&lt;/td>
&lt;td>mult&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4&amp;rsquo;b0010&lt;/td>
&lt;td>multu&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4&amp;rsquo;b0011&lt;/td>
&lt;td>div&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4&amp;rsquo;b0100&lt;/td>
&lt;td>divu&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4&amp;rsquo;b0101&lt;/td>
&lt;td>mthi&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4&amp;rsquo;b0110&lt;/td>
&lt;td>mtlo&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4&amp;rsquo;b0111&lt;/td>
&lt;td>mfhi&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4&amp;rsquo;b1000&lt;/td>
&lt;td>mflo&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// in MulDivBlock
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">always&lt;/span> &lt;span class="p">@(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">op&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">4&lt;/span>&lt;span class="mb">&amp;#39;b0001&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="n">prod_HI&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">prod_LO&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">$signed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">$signed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="c1">//mult
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="mh">4&lt;/span>&lt;span class="mb">&amp;#39;b0010&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="n">prod_HI&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">prod_LO&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">$unsigned&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">$unsigned&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="c1">//multu
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="mh">4&lt;/span>&lt;span class="mb">&amp;#39;b0011&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="n">prod_HI&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">prod_LO&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="n">$signed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">$signed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">$signed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="n">$signed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">)};&lt;/span>&lt;span class="c1">//div
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="mh">4&lt;/span>&lt;span class="mb">&amp;#39;b0100&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="n">prod_HI&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">prod_LO&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="n">A&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">B&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="n">B&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="c1">//divu
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">endcase&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">mdb_output&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">mdOp_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">4&lt;/span>&lt;span class="mb">&amp;#39;b0111&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">mdb_HI:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">mdOp_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">4&lt;/span>&lt;span class="mb">&amp;#39;b1000&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">mdb_LO:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">32&lt;/span>&lt;span class="mi">&amp;#39;d0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="load_type-3-bit">load_type (3-bit)
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>load_type&lt;/th>
&lt;th>type&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>3&amp;rsquo;b000&lt;/td>
&lt;td>lw&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>3&amp;rsquo;b001&lt;/td>
&lt;td>lbu&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>3&amp;rsquo;b010&lt;/td>
&lt;td>lb&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>3&amp;rsquo;b011&lt;/td>
&lt;td>lhu&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>3&amp;rsquo;b100&lt;/td>
&lt;td>lh&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="k">assign&lt;/span> &lt;span class="n">data_out&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">load_type&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b000&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">data_input:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">load_type&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b001&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="mh">24&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">byte_sel&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">load_type&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b010&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="p">{{&lt;/span>&lt;span class="mh">24&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">byte_sel&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">7&lt;/span>&lt;span class="p">]}},&lt;/span> &lt;span class="n">byte_sel&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">load_type&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b011&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="mh">16&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">hw_sel&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">load_type&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b100&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="p">{{&lt;/span>&lt;span class="mh">16&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">hw_sel&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">15&lt;/span>&lt;span class="p">]}},&lt;/span> &lt;span class="n">hw_sel&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">32&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="store_type-3-bit">store_type (3-bit)
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>store_type&lt;/th>
&lt;th>type&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>3&amp;rsquo;b001&lt;/td>
&lt;td>sw&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>3&amp;rsquo;b010&lt;/td>
&lt;td>sb&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>3&amp;rsquo;b100&lt;/td>
&lt;td>sh&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">3&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">byteen_MA&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">store_type_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b001&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">4&lt;/span>&lt;span class="mb">&amp;#39;b1111&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="c1">//word
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">store_type_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b010&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">byte_sel:&lt;/span>&lt;span class="c1">//byte
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">store_type_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b100&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">hw_sel:&lt;/span>&lt;span class="c1">//half word
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="mh">4&lt;/span>&lt;span class="mb">&amp;#39;b0000&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="测试方案">测试方案
&lt;/h2>&lt;h3 id="指令分类">指令分类
&lt;/h3>&lt;h4 id="r-type">R-type
&lt;/h4>&lt;ul>
&lt;li>&lt;em>&lt;strong>ALU型指令（Grd &amp;lt;- Grs ? Grt）&lt;/strong>&lt;/em>——（add、sub、or、and、slt、sltu）&lt;/li>
&lt;li>&lt;em>&lt;strong>ALU型指令（Grd &amp;lt;- Grt ？ shamt）&lt;/strong>&lt;/em>——（sll、srl、sra）&lt;/li>
&lt;li>&lt;em>&lt;strong>跳转型指令（PC &amp;lt;- Grs）&lt;/strong>&lt;/em>——（jr）&lt;/li>
&lt;/ul>
&lt;h4 id="i-type">I-type
&lt;/h4>&lt;ul>
&lt;li>&lt;em>&lt;strong>ALU-Imm型指令（Grt &amp;lt;- Grs ？ imm）&lt;/strong>&lt;/em>——（ori、lui、addi、andi）&lt;/li>
&lt;li>&lt;em>&lt;strong>Memory-Store型指令（Memory[Grs + offset] &amp;lt;- Grt）&lt;/strong>&lt;/em>——（sw、sb、sh）&lt;/li>
&lt;li>&lt;em>&lt;strong>Memory-load型指令（Grt &amp;lt;- Memory[Grs + offset]）&lt;/strong>&lt;/em>——（lw、lb、lbu、lh）&lt;/li>
&lt;li>&lt;em>&lt;strong>Branch型指令（Grs ? Grt，PC &amp;lt;- PC + 4 + offset）&lt;/strong>&lt;/em>——（beq、bgez、bgtz、blez、bltz、bne）&lt;/li>
&lt;/ul>
&lt;h4 id="j-type">J-type
&lt;/h4>&lt;ul>
&lt;li>&lt;em>&lt;strong>J-link型指令&lt;/strong>&lt;/em> —— (jal)&lt;/li>
&lt;li>&lt;em>&lt;strong>无条件Jump型指令&lt;/strong>&lt;/em>&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>IF级&lt;/th>
&lt;th>ID级&lt;/th>
&lt;th>EX级&lt;/th>
&lt;th>MA级&lt;/th>
&lt;th>WB级&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;em>&lt;strong>R-ALU&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;/td>
&lt;td>读取数据（Grs、Grt）&lt;/td>
&lt;td>计算数据&lt;/td>
&lt;td>&lt;/td>
&lt;td>写入数据&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;em>&lt;strong>R-jump&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;/td>
&lt;td>读取数据并跳转&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;em>&lt;strong>I-imm&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;/td>
&lt;td>读取数据（Grt、imm）&lt;/td>
&lt;td>计算数据&lt;/td>
&lt;td>&lt;/td>
&lt;td>写入数据&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;em>&lt;strong>I-store&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;/td>
&lt;td>读取数据（Grs+offset、Grt）&lt;/td>
&lt;td>计算数据（地址）&lt;/td>
&lt;td>写入数据&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;em>&lt;strong>I-load&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;/td>
&lt;td>读取数据（Grs+offset、Grt）&lt;/td>
&lt;td>计算数据（地址）&lt;/td>
&lt;td>读取数据&lt;/td>
&lt;td>写入数据&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;em>&lt;strong>I-branch&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;/td>
&lt;td>读取数据（Grs、Grt）比较数据并跳转&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;em>&lt;strong>J-link&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;/td>
&lt;td>扩展数据并跳转&lt;/td>
&lt;td>传递跳转PC&lt;/td>
&lt;td>传递跳转PC&lt;/td>
&lt;td>写入pc+8&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="测试步骤">测试步骤
&lt;/h3>&lt;ol>
&lt;li>编写测试代码
&lt;ul>
&lt;li>包括所有阻塞情况&lt;/li>
&lt;li>测试所有转发通路&lt;/li>
&lt;li>可利用课程组提供的分析工具对代码测试强度进行评估&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>将ISE输出与Mars输出比对
&lt;ul>
&lt;li>可利用同学开发评测机进行快速比对&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>大量随机数据强测
&lt;ul>
&lt;li>代码生成来自&lt;a class="link" href="hyggge.github.io" >学长博客&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">random&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">list_R&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;addu&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;subu&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;and&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;or&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;nor&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;xor&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;sltu&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;slt&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;sllv&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;srlv&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;srav&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">list_I&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;andi&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;addiu&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;ori&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;xori&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;lui&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;slti&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;sltiu&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">list_LS&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;lw&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;sw&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;lh&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;lhu&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;sh&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;lb&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;lbu&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;sb&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">list_shift&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;sll&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;srl&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;sra&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">list_B&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;bne&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;beq&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;bgtz&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;blez&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;bltz&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;bgez&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">list_MD&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;mult&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;multu&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;div&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;divu&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">list_MTMF&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;mfhi&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;mflo&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;mthi&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;mtlo&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#length是生成的指令所用到的寄存器个数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">length&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">8&lt;/span> &lt;span class="c1">#为了增大冒险概率，我们将寄存器的范围缩小到0~7&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">R_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">k&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">list_R&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">length&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">length&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">length&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">s&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2"> $&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">, $&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">, $&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">list_R&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">rd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">rs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">rt&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">I_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">k&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">list_I&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">length&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">length&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">imm&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">32768&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">32768&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">abs_imm&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">65536&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">list_I&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;lui&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">s&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2"> $&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">,&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">list_I&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">rt&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">abs_imm&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">s&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2"> $&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">, $&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">, &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">list_I&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">rt&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">rs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">imm&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">LS_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">k&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">list_LS&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ins&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">list_LS&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">num&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ins&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;w&amp;#34;&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">num&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="mi">4096&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ins&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;h&amp;#34;&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">num&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="mi">4096&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">num&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">10000000&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="mi">4096&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">length&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">s&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2"> $&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">, &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">($0)&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ins&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">rt&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">num&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">shift_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">k&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">list_shift&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">shamt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">length&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">length&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">length&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">s&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2"> $&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">, $&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">, &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">list_shift&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">rd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">rt&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">shamt&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">MD_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">k&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">list_MD&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">length&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">length&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">list_MD&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;mult&amp;#34;&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="n">list_MD&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;mul&amp;#34;&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">s&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2"> $&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">, $&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">list_MD&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">rs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">rt&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">s&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2"> $&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">, $&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">list_MD&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">rs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">8&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">MTMF_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">k&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">list_MTMF&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">length&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">s&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2"> $&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">list_MTMF&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">rs&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">B_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lable&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">k&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">list_B&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">k&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="n">k&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">length&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">length&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">s&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2"> $&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">, $&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">, &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">list_B&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">rs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">rt&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lable&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">length&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">s&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2"> $&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">, &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">list_B&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">rs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">lable&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">b_begin&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">b_test_&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">_one:&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">B_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;b_test_&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">_one_then&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">R_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;b_test_&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">_two:&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">B_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;b_test_&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">_two_then&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">I_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;jal_test_&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">:&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;jal jal_test_&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">_then&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">I_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;end_&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">:&lt;/span>&lt;span class="se">\n\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">R_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">I_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">LS_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">shift_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">b_end&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">b_test_&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">_one_then:&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">R_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">I_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">LS_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">shift_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MD_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MTMF_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;j b_test_&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">_two&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">R_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">b_test_&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">_two_then:&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">R_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">I_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">LS_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">shift_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MD_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MTMF_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;jal jal_test_&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;addu $1, $ra, $0&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">jal_test_&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">_then:&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">R_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">I_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">LS_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">shift_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MD_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MTMF_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;addiu $ra,$ra, 8&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">B_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;end_&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">R_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">I_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">LS_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">shift_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MD_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MTMF_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;jr $ra&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;mips_code.asm&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;w&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">file&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">length&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">temp&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2147483648&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2147483648&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">s&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;li $&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2"> &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">temp&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;li $8, &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2147483648&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2147483648&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="mi">10000&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">R_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MD_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MTMF_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">I_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">LS_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MTMF_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">I_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">shift_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="思考题">思考题
&lt;/h2>&lt;ol>
&lt;li>为什么需要有单独的乘除法部件而不是整合进 ALU？为何需要有独立的 HI、LO 寄存器？&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>[!ANS]
因为乘除操作较为复杂，需要多个周期才能完成，需要单独处理&lt;/p>&lt;/blockquote>
&lt;ol start="2">
&lt;li>真实的流水线 CPU 是如何使用实现乘除法的？请查阅相关资料进行简单说明。&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">`define size 8
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="k">module&lt;/span> &lt;span class="n">mul_booth_signed&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">input&lt;/span> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="no">`size&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mh">1&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">mul1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">mul2&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">input&lt;/span> &lt;span class="n">clk&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">input&lt;/span> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">2&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">clk_cnt&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="c1">//运算节拍，相当于状态机了，8位的话每次运算有4个拍
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">output&lt;/span> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">2&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="no">`size&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mh">1&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">res&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//由于传值默认就是补码，所以只需要再计算“负补码”即可
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="no">`size&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mh">1&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">bmul1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">bmul2&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">assign&lt;/span> &lt;span class="n">bmul1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">~&lt;/span>&lt;span class="n">mul1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="mb">&amp;#39;b1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">assign&lt;/span> &lt;span class="n">bmul2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">~&lt;/span>&lt;span class="n">mul2&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="mb">&amp;#39;b1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">;&lt;/span>&lt;span class="c1">//其实乘数2的负补码也没用到。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//其实可以把状态机的开始和结束状态都写出来，我懒得写了，同学们可以尝试一下啊~
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">parameter&lt;/span> &lt;span class="n">zeroone&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">twothree&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b001&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fourfive&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b010&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sixseven&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b011&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//y(i-1),y(i),y(i+1)三个数的判断寄存器，由于有多种情况，也可以看成状态机（也可以改写成状态机形式，大家自己试试吧）
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">reg&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">2&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">temp&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//部分积
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">reg&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">2&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="no">`size&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mh">1&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">A&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//每个节拍下把相应位置的数据传给temp寄存器
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">always&lt;/span> &lt;span class="p">@&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">posedge&lt;/span> &lt;span class="n">clk&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">clk_cnt&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">zeroone&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">temp&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="n">mul2&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">twothree&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">temp&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">mul2&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">3&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fourfive&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">temp&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">mul2&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">5&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">3&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sixseven&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">temp&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">mul2&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mh">7&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">5&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">default&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">temp&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">endcase&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">always&lt;/span> &lt;span class="p">@(&lt;/span>&lt;span class="k">posedge&lt;/span> &lt;span class="n">clk&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">clk_cnt&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b100&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>&lt;span class="c1">//如果节拍到4就让部分积归0，此时已经完成一次计算了
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">case&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">temp&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b000&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b111&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="k">begin&lt;/span>&lt;span class="c1">//这些是从高位到低位的判断，别看反了噢
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b001&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b010&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="k">begin&lt;/span>&lt;span class="c1">//加法操作使用补码即可，倍数利用左移解决
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="p">({{&lt;/span>&lt;span class="mh">8&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">mul1&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="no">`size&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="p">]}},&lt;/span>&lt;span class="n">mul1&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">clk_cnt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b011&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">A&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="p">({{&lt;/span>&lt;span class="mh">8&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">mul1&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="no">`size&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="p">]}},&lt;/span>&lt;span class="n">mul1&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">clk_cnt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b100&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="k">begin&lt;/span>&lt;span class="c1">//减法操作利用“负补码”改成加法操作，倍数利用左移解决
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="p">({{&lt;/span>&lt;span class="mh">8&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">bmul1&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="no">`size&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="p">]}},&lt;/span>&lt;span class="n">bmul1&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">clk_cnt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b101&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b110&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">A&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="p">({{&lt;/span>&lt;span class="mh">8&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">bmul1&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="no">`size&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="p">]}},&lt;/span>&lt;span class="n">bmul1&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">clk_cnt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">default&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">endcase&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//当节拍到4的时候写入结果寄存器。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">assign&lt;/span> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">clk_cnt&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">3&lt;/span>&lt;span class="mb">&amp;#39;b100&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">endmodule&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>请结合自己的实现分析，你是如何处理 Busy 信号带来的周期阻塞的？&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>[!ANS]
修改P5中的Stall逻辑，当乘除槽处于start或busy状态，且ID级指令需要使用乘除槽时阻塞&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">Stall_md&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">busy&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">mult_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">multu_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">div_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">divu_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">mfhi_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">mflo_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">mthi_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">mtlo_ID&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">assign&lt;/span> &lt;span class="n">Stall&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Stall_RS_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">Stall_RS_MA&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">Stall_RT_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">Stall_RT_MA&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">Stall_md&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="4">
&lt;li>请问采用字节使能信号的方式处理写指令有什么好处？（提示：从清晰性、统一性等角度考虑）&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>[!ANS]
更符合实际CPU电路，在实际电路中这样做更加高效。对于外部存储单元，其只需要读取使能信号然后进行相应存储即可，无需增加其他存储逻辑，使外部设备有较为统一的存储逻辑，便于扩展。&lt;/p>&lt;/blockquote>
&lt;ol start="5">
&lt;li>请思考，我们在按字节读和按字节写时，实际从 DM 获得的数据和向 DM 写入的数据是否是一字节？在什么情况下我们按字节读和按字节写的效率会高于按字读和按字写呢？&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>[!ANS]
不是一字节。当存储容量较小时按字节读和写会更加高效, 不需要添加多余的逻辑。&lt;/p>&lt;/blockquote>
&lt;ol start="6">
&lt;li>为了对抗复杂性你采取了哪些抽象和规范手段？这些手段在译码和处理数据冲突的时候有什么样的特点与帮助？&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>[!ANS]&lt;/p>
&lt;ol>
&lt;li>在高层模块的排布中就屏蔽了实现的细节，只保留了此模块的端口，以及端口的功能。&lt;/li>
&lt;li>对于同一类型的指令增加多位宽type信号，功能模块根据不同type信号执行对应操作。例如：涉及乘除槽的指令，我设置一个mdOp信号来区分指令，从而减少了流水寄存器的接口数目，从而降低复杂度。&lt;/li>
&lt;li>是否阻塞全部放到冲突处理模块判断，尽可能遵循“高内聚低耦合”的原则。&lt;/li>
&lt;li>乘除槽与ALU分离，但是输出路径一致。不需要更改转发逻辑。&lt;/li>
&lt;/ol>&lt;/blockquote>
&lt;ol start="7">
&lt;li>在本实验中你遇到了哪些不同指令类型组合产生的冲突？你又是如何解决的？相应的测试样例是什么样的？&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>[!ANS]
涉及到HI和LO寄存器的指令与其他读写寄存器指令冲突。通过设置合理的阻塞逻辑解决。&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ori $2, $0, 128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lw $3, 0($0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mult $3, $2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="8">
&lt;li>如果你是手动构造的样例，请说明构造策略，说明你的测试程序如何保证&lt;strong>覆盖&lt;/strong>了所有需要测试的情况；如果你是&lt;strong>完全随机&lt;/strong>生成的测试样例，请思考完全随机的测试程序有何不足之处；如果你在生成测试样例时采用了&lt;strong>特殊的策略&lt;/strong>，比如构造连续数据冒险序列，请你描述一下你使用的策略如何&lt;strong>结合了随机性&lt;/strong>达到强测的效果。&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>[!ANS]
我才用的方案是手动构造样例确保新指令的功能正确性，随机生成指令强测确保转发和阻塞的正确性。限制读写寄存器的范围，能够尽可能多的造成数据冒险，再加上大量随机数据，基本可以覆盖全部转发和阻塞情况。&lt;/p>&lt;/blockquote>
&lt;ol start="9">
&lt;li>[P5、P6 选做] 请评估我们给出的覆盖率分析模型的合理性，如有更好的方案，可一并提出。&lt;/li>
&lt;/ol></description></item><item><title>P5_设计文档</title><link>https://lhy0424.top/p/co_p5/</link><pubDate>Thu, 14 Nov 2024 00:11:00 +0000</pubDate><guid>https://lhy0424.top/p/co_p5/</guid><description>&lt;img src="https://lhy0424.top/p/co_p5/P5_cover.jpg" alt="Featured image of post P5_设计文档" />&lt;h1 id="p5_document">P5_document
&lt;/h1>&lt;h2 id="hazardv">Hazard.v
&lt;/h2>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>input&lt;/th>
&lt;th>explain&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Instr_ID&lt;/td>
&lt;td>ID阶段的指令码&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Instr_EX&lt;/td>
&lt;td>EX阶段的指令码&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Instr_MA&lt;/td>
&lt;td>MA阶段的指令码&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>A3_EX&lt;/td>
&lt;td>EX阶段的寄存器写入地址&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>A3_MA&lt;/td>
&lt;td>MA阶段的寄存器写入地址&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="t_use表格需求者">T_use表格（需求者）
&lt;/h4>&lt;p>指令位于ID级时，还需要多少个周期才必须要使用数据。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>$T_{use}(rs)$&lt;/th>
&lt;th>$T_{use}(rt)$&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>add&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>sub&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ori&lt;/td>
&lt;td>1&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>lw&lt;/td>
&lt;td>1&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>sw&lt;/td>
&lt;td>1&lt;/td>
&lt;td>2&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>beq&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>lui&lt;/td>
&lt;td>1&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>jal&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>jr&lt;/td>
&lt;td>0&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>nop&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">Tuse_rs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">add_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">sub_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">ori_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">lw_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">sw_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">lui_ID&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b01&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">beq_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">jr_ID&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b11&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">Tuse_rt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">add_ID&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">sub_ID&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b01&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">sw_ID&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b10&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">beq_ID&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b11&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="t_new表格供给者">T_new表格（供给者）
&lt;/h4>&lt;p>T_new: 供给指令位于某个流水级时还需要多少个周期才可以计算出结果并存储到流水寄存器中。&lt;/p>
&lt;p>&lt;em>&lt;strong>早于需求指令进入流水线的供给者还需要多少cycle能够产生需求者需要的寄存器值。&lt;/strong>&lt;/em>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Intsr&lt;/th>
&lt;th>功能部件(结果来源)&lt;/th>
&lt;th>EX&lt;/th>
&lt;th>MA&lt;/th>
&lt;th>WB&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>add&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>1&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>sub&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>1&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ori&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>1&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>lw&lt;/td>
&lt;td>DM&lt;/td>
&lt;td>2&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>sw&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>beq&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>lui&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>1&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>jal&lt;/td>
&lt;td>PC&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>jr&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>nop&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">Tnew_EX&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">add_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">sub_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">ori_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">lui_EX&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b01&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">lw_EX&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b10&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">Tnew_MA&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">lw_MA&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b01&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="rs策略矩阵">rs策略矩阵
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>$T_{use} \textbackslash \space T_{new}$&lt;/th>
&lt;th>EX&lt;/th>
&lt;th>EX&lt;/th>
&lt;th>EX&lt;/th>
&lt;th>MA&lt;/th>
&lt;th>MA&lt;/th>
&lt;th>MA&lt;/th>
&lt;th>WB&lt;/th>
&lt;th>WB&lt;/th>
&lt;th>WB&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>DM&lt;/td>
&lt;td>PC&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>DM&lt;/td>
&lt;td>PC&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>DM&lt;/td>
&lt;td>PC&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>1&lt;/td>
&lt;td>2&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>0&lt;/td>
&lt;td>&lt;strong>S&lt;/strong>&lt;/td>
&lt;td>&lt;strong>S&lt;/strong>&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>&lt;strong>S&lt;/strong>&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>1&lt;/td>
&lt;td>F&lt;/td>
&lt;td>&lt;strong>S&lt;/strong>&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="rt策略矩阵">rt策略矩阵
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>$T_{use} \textbackslash \space T_{new}$&lt;/th>
&lt;th>EX&lt;/th>
&lt;th>EX&lt;/th>
&lt;th>EX&lt;/th>
&lt;th>MA&lt;/th>
&lt;th>MA&lt;/th>
&lt;th>MA&lt;/th>
&lt;th>WB&lt;/th>
&lt;th>WB&lt;/th>
&lt;th>WB&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>DM&lt;/td>
&lt;td>PC&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>DM&lt;/td>
&lt;td>PC&lt;/td>
&lt;td>ALU&lt;/td>
&lt;td>DM&lt;/td>
&lt;td>PC&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>1&lt;/td>
&lt;td>2&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>0&lt;/td>
&lt;td>&lt;strong>S&lt;/strong>&lt;/td>
&lt;td>&lt;strong>S&lt;/strong>&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>&lt;strong>S&lt;/strong>&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>1&lt;/td>
&lt;td>F&lt;/td>
&lt;td>&lt;strong>S&lt;/strong>&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;td>F&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="如何理解策略矩阵">如何理解策略矩阵
&lt;/h3>&lt;ul>
&lt;li>策略矩阵针对的是AT法中的Time部分，具体判断阻塞还是转发需要综合Adress部分&lt;/li>
&lt;li>对于ALU型指令，如add，只需要关注 $T_{new}$ 的ALU一列，其表示在当前流水级下，还有多少周期才能计算出结果并存入流水级寄存器。&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">Stall_RS_EX&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Tuse_rs&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">Tnew_EX&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">RS_ID&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">RS_ID&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">Stall_RS_MA&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Tuse_rs&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">Tnew_MA&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">RS_ID&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">RS_ID&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">Stall_RT_EX&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Tuse_rt&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">Tnew_EX&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">RT_ID&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">RT_ID&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="n">Stall_RT_MA&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Tuse_rt&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">Tnew_MA&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">RT_ID&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">RT_ID&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">assign&lt;/span> &lt;span class="n">Stall&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Stall_RS_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">Stall_RS_MA&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">Stall_RT_EX&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">Stall_RT_MA&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="forward-in-mipsv">Forward in mips.v
&lt;/h2>&lt;h4 id="数据的供给者">数据的供给者
&lt;/h4>&lt;ul>
&lt;li>EX_MA级流水线寄存器&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">forward_EX_MA&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">RegWrite_MA&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Mem2Reg_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">ALU_C_MA:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">RegWrite_MA&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Mem2Reg_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b10&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="n">pc_add4_MA&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">32&lt;/span>&lt;span class="mi">&amp;#39;d4&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">32&amp;#39;h404&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>MA_WB级流水线寄存器&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="k">assign&lt;/span> &lt;span class="n">grf_WD&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Mem2Reg_WB&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">ALU_C_WB&lt;/span> &lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">Mem2Reg_WB&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b01&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">dm_data_WB&lt;/span> &lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">Mem2Reg_WB&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b10&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">pc_add4_WB&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">32&lt;/span>&lt;span class="mi">&amp;#39;d4&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="mh">32&lt;/span>&lt;span class="mi">&amp;#39;d0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">forward_MA_WB&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">RegWrite_WB&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">grf_WD:&lt;/span> &lt;span class="mh">32&amp;#39;h405&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="数据需求者">数据需求者
&lt;/h4>&lt;ul>
&lt;li>ID级&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">RD1_ID_valid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">RS_ID&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">A3_MA&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_MA&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">5&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">forward_EX_MA:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">((&lt;/span>&lt;span class="n">RS_ID&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">A3_WB&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_WB&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">5&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">forward_MA_WB:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RD1_ID&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">RD2_ID_valid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">RT_ID&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">A3_MA&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_MA&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">5&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">forward_EX_MA:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">((&lt;/span>&lt;span class="n">RT_ID&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">A3_WB&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_WB&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">5&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">forward_MA_WB:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RD2_ID&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>EX级&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//forward--select valid ALU_A and ALU_B
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">ALU_A_EX_valid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">RS_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">A3_MA&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_MA&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">5&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">forward_EX_MA:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">((&lt;/span>&lt;span class="n">RS_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">A3_WB&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_WB&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">5&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">forward_MA_WB:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RD1_EX&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">Grt_EX_valid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">RT_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">A3_MA&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_MA&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">5&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">forward_EX_MA:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">((&lt;/span>&lt;span class="n">RT_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">A3_WB&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_WB&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">5&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">forward_MA_WB:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RD2_EX&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="c1">//将目前正确的Grt值，流水到MA级供sw指令使用，也可供R-type-ALU指令使用
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">Grt_MA_valid&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">ALU_B_EX_valid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">ALUSrc_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="nl">Grt_EX_valid:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">ALUSrc_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="mb">&amp;#39;b1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">ext32_EX&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="mh">32&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>MA级&lt;/p>
&lt;p>再一次获取转发数据，确保DM中的Grt值是正确的&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">wire&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">Grt_MA_valid_valid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">RT_MA&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">A3_WB&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">A3_WB&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mh">5&lt;/span>&lt;span class="mi">&amp;#39;d0&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">forward_MA_WB:&lt;/span> &lt;span class="n">Grt_MA_valid&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="流水线寄存器">流水线寄存器
&lt;/h2>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>PC&lt;/th>
&lt;th>IF_ID&lt;/th>
&lt;th>ID_EX&lt;/th>
&lt;th>EX_MA&lt;/th>
&lt;th>MA_WB&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>en&lt;/td>
&lt;td>nStall&lt;/td>
&lt;td>nStall&lt;/td>
&lt;td>true&lt;/td>
&lt;td>false&lt;/td>
&lt;td>true&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>clr&lt;/td>
&lt;td>null&lt;/td>
&lt;td>false&lt;/td>
&lt;td>Stall&lt;/td>
&lt;td>true&lt;/td>
&lt;td>false&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>RegDst&lt;/th>
&lt;th>ExtOp&lt;/th>
&lt;th>jump&lt;/th>
&lt;th>jumpSrc&lt;/th>
&lt;th>branch&lt;/th>
&lt;th>bOp&lt;/th>
&lt;th>ALUSrc&lt;/th>
&lt;th>ALUOP&lt;/th>
&lt;th>MemWrite&lt;/th>
&lt;th>ls_type&lt;/th>
&lt;th>Mem2Reg&lt;/th>
&lt;th>RegWrite&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>作用阶段&lt;/td>
&lt;td>EX&lt;/td>
&lt;td>ID&lt;/td>
&lt;td>ID&lt;/td>
&lt;td>ID&lt;/td>
&lt;td>ID&lt;/td>
&lt;td>ID&lt;/td>
&lt;td>EX&lt;/td>
&lt;td>EX&lt;/td>
&lt;td>MA&lt;/td>
&lt;td>MA&lt;/td>
&lt;td>WB&lt;/td>
&lt;td>WB&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>IF_ID&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ID_EX&lt;/td>
&lt;td>1&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>EX_MA&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>MA_WB&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="stall-explain">Stall Explain
&lt;/h4>&lt;p>ID级指令静止，EX级插入一个nop&lt;/p>
&lt;ul>
&lt;li>PC不写入新数据&lt;/li>
&lt;li>IF_ID寄存器不写入新数据&lt;/li>
&lt;li>ID_EX寄存器清零，即插入nop(0x00000000)&lt;/li>
&lt;/ul>
&lt;h4 id="logic">Logic
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl">&lt;span class="k">module&lt;/span> &lt;span class="n">Stage_Reg&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">input&lt;/span> &lt;span class="n">clk&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">input&lt;/span> &lt;span class="n">reset&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">input&lt;/span> &lt;span class="n">en&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">input&lt;/span> &lt;span class="n">clr&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">input&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">output&lt;/span> &lt;span class="kt">reg&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mh">31&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mh">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">data_out&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">initial&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">data_out&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">always&lt;/span> &lt;span class="p">@(&lt;/span>&lt;span class="k">posedge&lt;/span> &lt;span class="n">clk&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">reset&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">clr&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">data_out&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">en&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">data_out&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="信号解释">信号解释
&lt;/h2>&lt;h4 id="jumpsrc-2-bit">jumpSrc (2-bit)
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>jumpSrc&lt;/th>
&lt;th>type&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>2&amp;rsquo;b00&lt;/td>
&lt;td>branch&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&amp;rsquo;b01&lt;/td>
&lt;td>jump&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&amp;rsquo;b10&lt;/td>
&lt;td>jr&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl">&lt;span class="k">assign&lt;/span> &lt;span class="n">next_pc_ID&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">jumpSrc_ID&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="nl">branch_offset_ID:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">jumpSrc_ID&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b01&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="nl">jumpExt32_ID:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">jumpSrc_ID&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b10&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="nl">RD1_ID_valid:&lt;/span> &lt;span class="mh">32&amp;#39;h404&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="mem2reg-2-bit">Mem2Reg (2-bit)
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Mem2Reg&lt;/th>
&lt;th>type&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>2‘b00&lt;/td>
&lt;td>ALU&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&amp;rsquo;b01&lt;/td>
&lt;td>lw&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&amp;rsquo;b10&lt;/td>
&lt;td>link&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl">&lt;span class="k">assign&lt;/span> &lt;span class="n">grf_WD&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Mem2Reg_WB&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">ALU_C_WB&lt;/span> &lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">Mem2Reg_WB&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b01&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">dm_data_WB&lt;/span> &lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">Mem2Reg_WB&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b10&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="n">pc_add4_WB&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mh">32&lt;/span>&lt;span class="mi">&amp;#39;d4&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="mh">32&lt;/span>&lt;span class="mi">&amp;#39;d0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="regdst-2-bit">RegDst (2-bit)
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>RegDst&lt;/th>
&lt;th>type&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>2&amp;rsquo;b00&lt;/td>
&lt;td>无需写入寄存器的指令&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&amp;rsquo;b01&lt;/td>
&lt;td>R-type，写入rd寄存器&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&amp;rsquo;b10&lt;/td>
&lt;td>I-type，写入rt寄存器&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&amp;rsquo;b11&lt;/td>
&lt;td>link，写入$ra ($31)&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl">&lt;span class="k">assign&lt;/span> &lt;span class="n">A3_EX&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">RegDst_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">5&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="c1">//null
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">RegDst_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b01&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">RD_EX:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">RegDst_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b10&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="nl">RT_EX:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">RegDst_EX&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b11&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">?&lt;/span> &lt;span class="mh">5&amp;#39;h1f&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mh">5&lt;/span>&lt;span class="mb">&amp;#39;b00000&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="alu-4-bit">ALU (4-bit)
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>ALU&lt;/th>
&lt;th>type&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>4&amp;rsquo;b0000&lt;/td>
&lt;td>add&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4&amp;rsquo;b0001&lt;/td>
&lt;td>sub&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4&amp;rsquo;b0010&lt;/td>
&lt;td>or&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4&amp;rsquo;b0011&lt;/td>
&lt;td>lui&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl">&lt;span class="k">always&lt;/span> &lt;span class="p">@(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">F&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="no">`ADD&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">B&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="no">`SUB&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">B&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="no">`OR&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">B&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="no">`SL16&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="mh">16&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">default&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="n">C&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mh">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">endcase&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="测试方案">测试方案
&lt;/h2>&lt;h3 id="指令分类">指令分类
&lt;/h3>&lt;h4 id="r-type">R-type
&lt;/h4>&lt;ul>
&lt;li>&lt;em>&lt;strong>ALU型指令（Grd &amp;lt;- Grs ? Grt）&lt;/strong>&lt;/em>——（add、sub、or）&lt;/li>
&lt;li>&lt;em>&lt;strong>ALU型指令（Grd &amp;lt;- Grt ？ shamt）&lt;/strong>&lt;/em>——（sll、srl、sra）&lt;/li>
&lt;li>&lt;em>&lt;strong>跳转型指令（PC &amp;lt;- Grs）&lt;/strong>&lt;/em>——（jr）&lt;/li>
&lt;/ul>
&lt;h4 id="i-type">I-type
&lt;/h4>&lt;ul>
&lt;li>&lt;em>&lt;strong>ALU-Imm型指令（Grt &amp;lt;- Grs ？ imm）&lt;/strong>&lt;/em>——（ori、lui）&lt;/li>
&lt;li>&lt;em>&lt;strong>Memory-Store型指令（Memory[Grs + offset] &amp;lt;- Grt）&lt;/strong>&lt;/em>——（sw、sb、sh）&lt;/li>
&lt;li>&lt;em>&lt;strong>Memory-load型指令（Grt &amp;lt;- Memory[Grs + offset]）&lt;/strong>&lt;/em>——（lw、lb、lbu、lh）&lt;/li>
&lt;li>&lt;em>&lt;strong>Branch型指令（Grs ? Grt，PC &amp;lt;- PC + 4 + offset）&lt;/strong>&lt;/em>——（beq、bgez、bgtz、blez、bltz、bne）&lt;/li>
&lt;/ul>
&lt;h4 id="j-type">J-type
&lt;/h4>&lt;ul>
&lt;li>&lt;em>&lt;strong>J-link型指令&lt;/strong>&lt;/em> —— (jal)&lt;/li>
&lt;li>&lt;em>&lt;strong>无条件Jump型指令&lt;/strong>&lt;/em>&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>IF级&lt;/th>
&lt;th>ID级&lt;/th>
&lt;th>EX级&lt;/th>
&lt;th>MA级&lt;/th>
&lt;th>WB级&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;em>&lt;strong>R-ALU&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;/td>
&lt;td>读取数据（Grs、Grt）&lt;/td>
&lt;td>计算数据&lt;/td>
&lt;td>&lt;/td>
&lt;td>写入数据&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;em>&lt;strong>R-jump&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;/td>
&lt;td>读取数据并跳转&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;em>&lt;strong>I-imm&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;/td>
&lt;td>读取数据（Grt、imm）&lt;/td>
&lt;td>计算数据&lt;/td>
&lt;td>&lt;/td>
&lt;td>写入数据&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;em>&lt;strong>I-store&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;/td>
&lt;td>读取数据（Grs+offset、Grt）&lt;/td>
&lt;td>计算数据（地址）&lt;/td>
&lt;td>写入数据&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;em>&lt;strong>I-load&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;/td>
&lt;td>读取数据（Grs+offset、Grt）&lt;/td>
&lt;td>计算数据（地址）&lt;/td>
&lt;td>读取数据&lt;/td>
&lt;td>写入数据&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;em>&lt;strong>I-branch&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;/td>
&lt;td>读取数据（Grs、Grt）比较数据并跳转&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;em>&lt;strong>J-link&lt;/strong>&lt;/em>&lt;/td>
&lt;td>&lt;/td>
&lt;td>扩展数据并跳转&lt;/td>
&lt;td>传递跳转PC&lt;/td>
&lt;td>传递跳转PC&lt;/td>
&lt;td>写入pc+8&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="测试步骤">测试步骤
&lt;/h3>&lt;ol>
&lt;li>编写测试代码
&lt;ul>
&lt;li>包括所有阻塞情况&lt;/li>
&lt;li>测试所有转发通路&lt;/li>
&lt;li>可利用课程组提供的分析工具对代码测试强度进行评估&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>将ISE输出与Mars输出比对
&lt;ul>
&lt;li>可利用同学开发评测机进行快速比对&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>大量随机数据强测
&lt;ul>
&lt;li>代码生成思路参照&lt;a class="link" href="http://cscore.buaa.edu.cn/#/discussion_area/1482/1793/posts" target="_blank" rel="noopener"
>P4数据生成思路&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">random&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">SUPPORTED_INSTRUCTIONS&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;add&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;sub&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;and&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;ori&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;lui&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1"># arithmetic &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;lw&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;sw&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1"># storage &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;beq&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;bne&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1"># B-type &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;j&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;jal&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1"># jump &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;nop&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># command jr will be generated according to the use of command jal &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">REGISTERS&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;$&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">32&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">26&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">weighted_choice&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">choices&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">REGISTERS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">weights&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">REGISTER_WEIGHTS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">k&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">generate_random_instruction&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">half&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">instruction&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">choice&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">SUPPORTED_INSTRUCTIONS&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">instruction&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;add&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;sub&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;and&amp;#34;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># add $t0, $t1, $t2 : op rd, rs, rt &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">weighted_choice&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">weighted_choice&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">weighted_choice&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">instruction&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2"> &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">rd&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">, &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">rs&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">, &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">rt&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># other instructions... &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># parser... &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">high_weight_registers&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sample&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">REGISTERS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># print(f&amp;#34;High weight registers: {high_weight_registers}&amp;#34;) &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">global&lt;/span> &lt;span class="n">REGISTER_WEIGHTS&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">REGISTER_WEIGHTS&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">4&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">reg&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">high_weight_registers&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">reg&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">REGISTERS&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mips_code&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">generate_mips_code&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">num_instructions&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="思考题">思考题
&lt;/h2>&lt;ol>
&lt;li>我们使用提前分支判断的方法尽早产生结果来减少因不确定而带来的开销，但实际上这种方法并非总能提高效率，请从流水线冒险的角度思考其原因并给出一个指令序列的例子。&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>提前分支判断会带增加阻塞的情况，从而降低效率&lt;/p>
&lt;p>lw $1, 0($0)
ori $2, $0, 514
beq $1, $2, label&lt;/p>
&lt;p>对于上述代码，需要阻塞两次&lt;/p>&lt;/blockquote>
&lt;ol start="2">
&lt;li>因为延迟槽的存在，对于 jal 等需要将指令地址写入寄存器的指令，要写回 PC + 8，请思考为什么这样设计？&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>因为，jr返回时应该执行延迟槽后面的指令&lt;/p>&lt;/blockquote>
&lt;ol start="3">
&lt;li>我们要求所有转发数据都来源于流水寄存器而不能是功能部件（如 DM、ALU），请思考为什么？&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>减少组合逻辑与时序逻辑的组合，减少毛刺，使流水线分级更清晰&lt;/p>&lt;/blockquote>
&lt;ol start="4">
&lt;li>我们为什么要使用 GPR 内部转发？该如何实现？&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>解决结构冒险。由于流水线中grf的读写在不同级，所以当同时读和写grf时会出现结构冒险&lt;/p>
&lt;p>assign RD1 = (A3!=0 &amp;amp; A1==A3 &amp;amp; WE) ? WD : grf[A1];&lt;br>
assign RD2 = (A3!=0 &amp;amp; A2==A3 &amp;amp; WE) ? WD : grf[A2];&lt;/p>&lt;/blockquote>
&lt;ol start="5">
&lt;li>我们转发时数据的需求者和供给者可能来源于哪些位置？共有哪些转发数据通路？&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>见上文&lt;/p>&lt;/blockquote>
&lt;ol start="6">
&lt;li>在课上测试时，我们需要你现场实现新的指令，对于这些新的指令，你可能需要在原有的数据通路上做哪些扩展或修改？提示：你可以对指令进行分类，思考每一类指令可能修改或扩展哪些位置。&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;ol>
&lt;li>添加控制信号&lt;/li>
&lt;li>可能需要修改ALU&lt;/li>
&lt;li>修改顶层模块，可能需要添加wire&lt;/li>
&lt;li>可能需要修改阻塞逻辑&lt;/li>
&lt;/ol>&lt;/blockquote>
&lt;ol start="7">
&lt;li>简要描述你的译码器架构，并思考该架构的优势以及不足。、&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>集中式译码。只需一次译码，然后流水各个信号。
优势：资源占用小，代码量小
不足：流水信号比较麻烦，添加控制信号时比较麻烦&lt;/p>&lt;/blockquote>
&lt;ol start="8">
&lt;li>[P5 选做] 请详细描述你的测试方案及测试数据构造策略。&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>见测试方案&lt;/p>&lt;/blockquote>
&lt;ol start="9">
&lt;li>[P5、P6 选做] 请评估我们给出的覆盖率分析模型的合理性，如有更好的方案，可一并提出。&lt;/li>
&lt;/ol></description></item><item><title>P4_设计文档</title><link>https://lhy0424.top/p/co_p4/</link><pubDate>Sat, 02 Nov 2024 18:06:00 +0000</pubDate><guid>https://lhy0424.top/p/co_p4/</guid><description>&lt;img src="https://lhy0424.top/p/co_p4/P4_cover.jpg" alt="Featured image of post P4_设计文档" />&lt;h1 id="p4_l0_document">P4_L0_document
&lt;/h1>&lt;h2 id="信号解释">信号解释
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>RegDst（寄存器写入地址）&lt;/strong>
&lt;ul>
&lt;li>2&amp;rsquo;b00: RT&lt;/li>
&lt;li>2&amp;rsquo;b01: RD&lt;/li>
&lt;li>2&amp;rsquo;b11: 5&amp;rsquo;h1f&lt;/li>
&lt;li>default: 5&amp;rsquo;b0&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>Mem2Reg（寄存器写入数据）&lt;/strong>
&lt;ul>
&lt;li>2&amp;rsquo;b00: alu_c&lt;/li>
&lt;li>2&amp;rsquo;b01: dm_data&lt;/li>
&lt;li>2&amp;rsquo;b10: pc + 32&amp;rsquo;d4&lt;/li>
&lt;li>default: 32&amp;rsquo;b0&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>ALUSrc（alu的b操作数选择）&lt;/strong>
&lt;ul>
&lt;li>1&amp;rsquo;b0: grf_RD2&lt;/li>
&lt;li>1&amp;rsquo;b1: ext_ext32&lt;/li>
&lt;li>default: 32&amp;rsquo;b0&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>ALU_F（ALU计算方式）&lt;/strong>
&lt;ul>
&lt;li>4&amp;rsquo;b0000: add&lt;/li>
&lt;li>4&amp;rsquo;b0001: sub&lt;/li>
&lt;li>4&amp;rsquo;b0010: or&lt;/li>
&lt;li>4&amp;rsquo;b0011: SL16 (lui)&lt;/li>
&lt;li>4&amp;rsquo;b0100: SLL (补0逻辑左移)&lt;/li>
&lt;li>4’b0101: SRL (补0逻辑右移)&lt;/li>
&lt;li>4‘b0110: SRA (算数右移)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>ExtOp (扩展操作)&lt;/strong>
&lt;ul>
&lt;li>2’b01: 0扩展&lt;/li>
&lt;li>2‘b10: 算术扩展（符号位）&lt;/li>
&lt;li>2’b11: 1扩展&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="设计草稿">设计草稿
&lt;/h2>&lt;p>本次CPU支持&lt;code>add, sub, or, ori, lw, sw, lb, lbu, lh, sb, sh, beq, lui, nop，begz，bgtz，blez，bltz，bne, j, jal, jr&lt;/code>共23条指令。&lt;/p>
&lt;h3 id="mipsv-top">mips.v (Top)
&lt;/h3>&lt;p>&lt;img src="https://lhy0424.top/p/co_p4/logisim_CPU.png"
width="2204"
height="1156"
srcset="https://lhy0424.top/p/co_p4/logisim_CPU_hu_b6e1a89de386ea01.png 480w, https://lhy0424.top/p/co_p4/logisim_CPU_hu_e38151aba6a13c1f.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="190"
data-flex-basis="457px"
>&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/co_p4/mips.svg"
loading="lazy"
alt="mips"
>&lt;/p>
&lt;h4 id="ports">Ports
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Port name&lt;/th>
&lt;th>Direction&lt;/th>
&lt;th>Type&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>clk&lt;/td>
&lt;td>input&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>reset&lt;/td>
&lt;td>input&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="signals">Signals
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Name&lt;/th>
&lt;th>Type&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>pc&lt;/td>
&lt;td>wire [31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>if_jump&lt;/td>
&lt;td>wire&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>if_branch&lt;/td>
&lt;td>wire&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>instr_out&lt;/td>
&lt;td>wire [31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ifu_offset&lt;/td>
&lt;td>wire [31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>OPCODE&lt;/td>
&lt;td>wire [5:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FUNCT&lt;/td>
&lt;td>wire [5:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>RS&lt;/td>
&lt;td>wire [4:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>RT&lt;/td>
&lt;td>wire [4:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>RD&lt;/td>
&lt;td>wire [4:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>SHAMT&lt;/td>
&lt;td>wire [4:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>IMM&lt;/td>
&lt;td>wire [15:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>INDEX&lt;/td>
&lt;td>wire [25:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>bOp_out&lt;/td>
&lt;td>wire [5:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>RegDst_out&lt;/td>
&lt;td>wire [1:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ALUSrc_out&lt;/td>
&lt;td>wire&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Mem2Reg_out&lt;/td>
&lt;td>wire [1:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>RegWrite_out&lt;/td>
&lt;td>wire&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>MemWrite_out&lt;/td>
&lt;td>wire&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>branch_out&lt;/td>
&lt;td>wire&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ExtOp_out&lt;/td>
&lt;td>wire [1:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ALUOP_out&lt;/td>
&lt;td>wire [1:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>jumpSrc_out&lt;/td>
&lt;td>wire [1:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>dm_data&lt;/td>
&lt;td>wire [31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ext_ext32&lt;/td>
&lt;td>wire [31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>grf_RD1&lt;/td>
&lt;td>wire [31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>grf_RD2&lt;/td>
&lt;td>wire [31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>alu_B&lt;/td>
&lt;td>wire [31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>alu_C&lt;/td>
&lt;td>wire [31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>grf_WA&lt;/td>
&lt;td>wire [4:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>grf_WD&lt;/td>
&lt;td>wire [31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>jumpext_ext32&lt;/td>
&lt;td>wire [31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="instantiations">Instantiations
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>ifu: IFU&lt;/p>
&lt;/li>
&lt;li>
&lt;p>controller: Controller&lt;/p>
&lt;/li>
&lt;li>
&lt;p>grf: GRF&lt;/p>
&lt;/li>
&lt;li>
&lt;p>alu: ALU&lt;/p>
&lt;/li>
&lt;li>
&lt;p>dm: DM&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ext: EXT&lt;/p>
&lt;/li>
&lt;li>
&lt;p>jumpext: jumpEXT&lt;/p>
&lt;/li>
&lt;li>
&lt;p>bcheck: bCheck&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="ifuv">IFU.v
&lt;/h3>&lt;p>&lt;img src="https://lhy0424.top/p/co_p4/IFU.png"
width="969"
height="630"
srcset="https://lhy0424.top/p/co_p4/IFU_hu_260e60f83d2f88f4.png 480w, https://lhy0424.top/p/co_p4/IFU_hu_a676316910adf921.png 1024w"
loading="lazy"
alt="IFU"
class="gallery-image"
data-flex-grow="153"
data-flex-basis="369px"
>&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/co_p4/IFU.svg"
loading="lazy"
alt="IFU"
>&lt;/p>
&lt;h4 id="ports-1">Ports
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Port name&lt;/th>
&lt;th>Direction&lt;/th>
&lt;th>Type&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>clk&lt;/td>
&lt;td>input&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>reset&lt;/td>
&lt;td>input&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>jump&lt;/td>
&lt;td>input&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>branch&lt;/td>
&lt;td>input&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>offset&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>PC&lt;/td>
&lt;td>output&lt;/td>
&lt;td>[31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Instr&lt;/td>
&lt;td>output&lt;/td>
&lt;td>[31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="controllerv">Controller.v
&lt;/h3>&lt;p>&lt;img src="https://lhy0424.top/p/co_p4/Controller.png"
width="2203"
height="1236"
srcset="https://lhy0424.top/p/co_p4/Controller_hu_feed0c1cd3ba30b1.png 480w, https://lhy0424.top/p/co_p4/Controller_hu_c24e85860a631164.png 1024w"
loading="lazy"
alt="Controller"
class="gallery-image"
data-flex-grow="178"
data-flex-basis="427px"
>&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/co_p4/Controller.svg"
loading="lazy"
alt="Controller"
>&lt;/p>
&lt;h4 id="ports-2">Ports
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Port name&lt;/th>
&lt;th>Direction&lt;/th>
&lt;th>Type&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>OpCode&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[5:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Funct&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[5:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>rt&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[4:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>jump&lt;/td>
&lt;td>output&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>jumpSrc&lt;/td>
&lt;td>output&lt;/td>
&lt;td>[1:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>bOp&lt;/td>
&lt;td>output&lt;/td>
&lt;td>[5:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>RegDst&lt;/td>
&lt;td>output&lt;/td>
&lt;td>[1:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ALUSrc&lt;/td>
&lt;td>output&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Mem2Reg&lt;/td>
&lt;td>output&lt;/td>
&lt;td>[1:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>RegWrite&lt;/td>
&lt;td>output&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>MemWrite&lt;/td>
&lt;td>output&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>branch&lt;/td>
&lt;td>output&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ExtOp&lt;/td>
&lt;td>output&lt;/td>
&lt;td>[1:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ALUOP&lt;/td>
&lt;td>output&lt;/td>
&lt;td>[1:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="信号映射表">信号映射表
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>OpCode&lt;/th>
&lt;th>Funct&lt;/th>
&lt;th>RT&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>add&lt;/td>
&lt;td>000000&lt;/td>
&lt;td>100000&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>sub&lt;/td>
&lt;td>000000&lt;/td>
&lt;td>100010&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>or&lt;/td>
&lt;td>000000&lt;/td>
&lt;td>100101&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>SLL&lt;/strong>&lt;/td>
&lt;td>000000&lt;/td>
&lt;td>000000&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>SRL&lt;/strong>&lt;/td>
&lt;td>000000&lt;/td>
&lt;td>000010&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>SRA&lt;/strong>&lt;/td>
&lt;td>000000&lt;/td>
&lt;td>000011&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ori&lt;/td>
&lt;td>001101&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>lw&lt;/td>
&lt;td>100011&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>sw&lt;/td>
&lt;td>101011&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>lb&lt;/strong>&lt;/td>
&lt;td>100000&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>lbu&lt;/strong>&lt;/td>
&lt;td>100100&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>lh&lt;/strong>&lt;/td>
&lt;td>100001&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>sb&lt;/strong>&lt;/td>
&lt;td>101000&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>sh&lt;/strong>&lt;/td>
&lt;td>101001&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>beq&lt;/td>
&lt;td>000100&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>lui&lt;/td>
&lt;td>001111&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>bgez&lt;/td>
&lt;td>000001&lt;/td>
&lt;td>&lt;/td>
&lt;td>00001&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>bgtz&lt;/td>
&lt;td>000111&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>blez&lt;/td>
&lt;td>000110&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>bltz&lt;/td>
&lt;td>000001&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>bne&lt;/td>
&lt;td>000101&lt;/td>
&lt;td>&lt;/td>
&lt;td>00000&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>jump&lt;/td>
&lt;td>000010&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>jal&lt;/td>
&lt;td>000011&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>jr&lt;/td>
&lt;td>000000&lt;/td>
&lt;td>001000&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>add&lt;/th>
&lt;th>sub&lt;/th>
&lt;th>ori&lt;/th>
&lt;th>SLL&lt;/th>
&lt;th>SRL&lt;/th>
&lt;th>SRA&lt;/th>
&lt;th>or&lt;/th>
&lt;th>lw&lt;/th>
&lt;th>sw&lt;/th>
&lt;th>lb&lt;/th>
&lt;th>lbu&lt;/th>
&lt;th>lh&lt;/th>
&lt;th>sb&lt;/th>
&lt;th>sh&lt;/th>
&lt;th>branch&lt;/th>
&lt;th>lui&lt;/th>
&lt;th>jump&lt;/th>
&lt;th>jal&lt;/th>
&lt;th>jr&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>RegDst&lt;/td>
&lt;td>01&lt;/td>
&lt;td>01&lt;/td>
&lt;td>00&lt;/td>
&lt;td>01&lt;/td>
&lt;td>01&lt;/td>
&lt;td>01&lt;/td>
&lt;td>01&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>11(const31)&lt;/td>
&lt;td>00&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ALUSrc&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Mem2Reg&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>01&lt;/td>
&lt;td>00&lt;/td>
&lt;td>01&lt;/td>
&lt;td>01&lt;/td>
&lt;td>01&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>10(PC + 4)&lt;/td>
&lt;td>00&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>RegWrite&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>MemWrite&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>branch&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ExtOp&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>01(zero)&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>00&lt;/td>
&lt;td>]10(signed)&lt;/td>
&lt;td>10(signed)&lt;/td>
&lt;td>10&lt;/td>
&lt;td>10&lt;/td>
&lt;td>10&lt;/td>
&lt;td>10&lt;/td>
&lt;td>10&lt;/td>
&lt;td>10(signed)&lt;/td>
&lt;td>10(signed)&lt;/td>
&lt;td>00&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ALUOP&amp;lt;3,0&amp;gt;&lt;/td>
&lt;td>0000&lt;/td>
&lt;td>0001&lt;/td>
&lt;td>0010&lt;/td>
&lt;td>0100&lt;/td>
&lt;td>0101&lt;/td>
&lt;td>0110&lt;/td>
&lt;td>0010&lt;/td>
&lt;td>0000(+)&lt;/td>
&lt;td>0000(+)&lt;/td>
&lt;td>0000&lt;/td>
&lt;td>0000&lt;/td>
&lt;td>0000&lt;/td>
&lt;td>0000&lt;/td>
&lt;td>0000&lt;/td>
&lt;td>0000(+)&lt;/td>
&lt;td>0011&lt;/td>
&lt;td>0000&lt;/td>
&lt;td>0000&lt;/td>
&lt;td>0000&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>jumpSrc&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>01&lt;/td>
&lt;td>01&lt;/td>
&lt;td>10&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>jump&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ls_type&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>01&lt;/td>
&lt;td>10&lt;/td>
&lt;td>11&lt;/td>
&lt;td>01&lt;/td>
&lt;td>11&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="grfv">GRF.v
&lt;/h3>&lt;p>&lt;img src="https://lhy0424.top/p/co_p4/GRF.png"
width="2217"
height="941"
srcset="https://lhy0424.top/p/co_p4/GRF_hu_1cbaf3b4dd8768d9.png 480w, https://lhy0424.top/p/co_p4/GRF_hu_466543eef7e3b78b.png 1024w"
loading="lazy"
alt="GRF"
class="gallery-image"
data-flex-grow="235"
data-flex-basis="565px"
>&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/co_p4/GRF.svg"
loading="lazy"
alt="GRF"
>&lt;/p>
&lt;h4 id="ports-3">Ports
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Port name&lt;/th>
&lt;th>Direction&lt;/th>
&lt;th>Type&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>A1&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[4:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>A2&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[4:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>A3&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[4:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>WD&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>clk&lt;/td>
&lt;td>input&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>reset&lt;/td>
&lt;td>input&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>WE&lt;/td>
&lt;td>input&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>pc&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>RD1&lt;/td>
&lt;td>output&lt;/td>
&lt;td>[31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>RD2&lt;/td>
&lt;td>output&lt;/td>
&lt;td>[31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="dmv">DM.v
&lt;/h3>&lt;p>&lt;img src="https://lhy0424.top/p/co_p4/DM.svg"
loading="lazy"
alt="DM"
>&lt;/p>
&lt;h4 id="ports-4">Ports
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Port name&lt;/th>
&lt;th>Direction&lt;/th>
&lt;th>Type&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>A&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>D_input&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>str&lt;/td>
&lt;td>input&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>clk&lt;/td>
&lt;td>input&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>pc&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>D_output&lt;/td>
&lt;td>output&lt;/td>
&lt;td>[31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="aluv">ALU.v
&lt;/h3>&lt;p>&lt;img src="https://lhy0424.top/p/co_p4/ALU.svg"
loading="lazy"
alt="ALU"
>&lt;/p>
&lt;h4 id="ports-5">Ports
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Port name&lt;/th>
&lt;th>Direction&lt;/th>
&lt;th>Type&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>A&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>B&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>shamt&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[4:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>F&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[3:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>C&lt;/td>
&lt;td>output&lt;/td>
&lt;td>[31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="bcheckv">bCheck.v
&lt;/h3>&lt;p>&lt;img src="https://lhy0424.top/p/co_p4/bCheck.png"
width="1652"
height="745"
srcset="https://lhy0424.top/p/co_p4/bCheck_hu_713d380c5af825c6.png 480w, https://lhy0424.top/p/co_p4/bCheck_hu_7ef70c1026195de.png 1024w"
loading="lazy"
alt="bCheck"
class="gallery-image"
data-flex-grow="221"
data-flex-basis="532px"
>&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/co_p4/bCheck.svg"
loading="lazy"
alt="bCheck"
>&lt;/p>
&lt;h4 id="ports-6">Ports
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Port name&lt;/th>
&lt;th>Direction&lt;/th>
&lt;th>Type&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Grs&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Grt&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>bOp&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[5:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>branch&lt;/td>
&lt;td>input&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>check&lt;/td>
&lt;td>output&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="extv">EXT.v
&lt;/h3>&lt;p>&lt;img src="https://lhy0424.top/p/co_p4/EXT.png"
width="798"
height="334"
srcset="https://lhy0424.top/p/co_p4/EXT_hu_12e1b4a627f3f351.png 480w, https://lhy0424.top/p/co_p4/EXT_hu_27593ea1fdf31eba.png 1024w"
loading="lazy"
alt="EXT"
class="gallery-image"
data-flex-grow="238"
data-flex-basis="573px"
>&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/co_p4/EXT.svg"
loading="lazy"
alt="EXT"
>&lt;/p>
&lt;h4 id="ports-7">Ports
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Port name&lt;/th>
&lt;th>Direction&lt;/th>
&lt;th>Type&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>imm16&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[15:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ExtOp&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[1:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ext32&lt;/td>
&lt;td>output&lt;/td>
&lt;td>[31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="jumpextv">jumpEXT.v
&lt;/h3>&lt;p>&lt;img src="https://lhy0424.top/p/co_p4/jumpEXT.png"
width="912"
height="398"
srcset="https://lhy0424.top/p/co_p4/jumpEXT_hu_4625e878bc2a25ae.png 480w, https://lhy0424.top/p/co_p4/jumpEXT_hu_b20552e79e0fef33.png 1024w"
loading="lazy"
alt="jumpEXT"
class="gallery-image"
data-flex-grow="229"
data-flex-basis="549px"
>&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/co_p4/jumpEXT.svg"
loading="lazy"
alt="jumpEXT"
>&lt;/p>
&lt;h4 id="ports-8">Ports
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Port name&lt;/th>
&lt;th>Direction&lt;/th>
&lt;th>Type&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>index&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[25:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>pc&lt;/td>
&lt;td>input&lt;/td>
&lt;td>[31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ext32&lt;/td>
&lt;td>output&lt;/td>
&lt;td>[31:0]&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="测试方案">测试方案
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>&lt;em>&lt;strong>利用魔改Mars：&lt;/strong>&lt;/em> 直接比较ISE得输出和Mars的输出&lt;/p>
&lt;/li>
&lt;li>
&lt;p>***课上环境：***在Isim中将32个Reg和内存添加到波形图中，对比最终结果&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>简单的测试代码：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;span class="lnt">86
&lt;/span>&lt;span class="lnt">87
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#GRF REG_WRITE TEST&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$1&lt;/span>, &lt;span class="m">125&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$2&lt;/span>, &lt;span class="m">300&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$3&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$4&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">1024&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$5&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">56&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$6&lt;/span>, &lt;span class="nv">$0&lt;/span>,125
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$7&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">525&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$8&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">10086&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$9&lt;/span>, &lt;span class="nv">$0&lt;/span>,14514
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$10&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">625&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$11&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">168&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$12&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">576&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$13&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">2048&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$14&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">6666&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$15&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">424&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$16&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">2024&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$16&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">1101&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$17&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">2203&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$18&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">2306&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$19&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">999&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$20&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">2005&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$21&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$22&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">176&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$23&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">616&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$24&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">1213&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$25&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">1314&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$26&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">888&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$27&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">545&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$28&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">28&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#LUI TEST&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lui &lt;span class="nv">$1&lt;/span>, &lt;span class="m">424&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lui &lt;span class="nv">$12&lt;/span>, &lt;span class="m">500&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lui &lt;span class="nv">$24&lt;/span>, &lt;span class="m">233&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#ADD or SUB TEST&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">add &lt;span class="nv">$21&lt;/span>, &lt;span class="nv">$27&lt;/span>, &lt;span class="nv">$28&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sub &lt;span class="nv">$21&lt;/span>, &lt;span class="nv">$27&lt;/span>, &lt;span class="nv">$28&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#MEMORY TEST&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sw &lt;span class="nv">$21&lt;/span>, 0&lt;span class="o">(&lt;/span>&lt;span class="nv">$0&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lw &lt;span class="nv">$28&lt;/span>, 0&lt;span class="o">(&lt;/span>&lt;span class="nv">$0&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#BRANCH TEST&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">beq &lt;span class="nv">$24&lt;/span>, &lt;span class="nv">$25&lt;/span>, beq_label_false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$24&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">1314&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">beq &lt;span class="nv">$24&lt;/span>, &lt;span class="nv">$25&lt;/span>, beq_label_true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">beq_label_false:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$5&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">666&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">beq_label_true:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$5&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">667&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#JUMP TEST&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">jal &lt;span class="k">function&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$5&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$5&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$5&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">9&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">j jump_label
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$5&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">1111&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">jr &lt;span class="nv">$ra&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">jump_label:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgez &lt;span class="nv">$0&lt;/span>, bgez_label
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$1&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">11451&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgez_label:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$1&lt;/span>, &lt;span class="nv">$0&lt;/span>, -10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bltz &lt;span class="nv">$1&lt;/span>, bltz_label
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$5&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">1314&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$6&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">156&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bltz_label:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bne &lt;span class="nv">$0&lt;/span>, &lt;span class="nv">$1&lt;/span>, bne_label
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$5&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">131&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ori &lt;span class="nv">$6&lt;/span>, &lt;span class="nv">$0&lt;/span>, &lt;span class="m">15&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bne_label:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lui &lt;span class="nv">$12&lt;/span>, &lt;span class="m">2333&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">//STDOUT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003000: $ &lt;span class="m">1&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 0000007d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003004: $ &lt;span class="m">2&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 0000012c
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003008: $ &lt;span class="m">3&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> &lt;span class="m">00000005&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@0000300c: $ &lt;span class="m">4&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> &lt;span class="m">00000400&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003010: $ &lt;span class="m">5&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> &lt;span class="m">00000038&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003014: $ &lt;span class="m">6&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 0000007d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003018: $ &lt;span class="m">7&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 0000020d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@0000301c: $ &lt;span class="m">8&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> &lt;span class="m">00002766&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003020: $ &lt;span class="m">9&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 000038b2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003024: &lt;span class="nv">$10&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> &lt;span class="m">00000271&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003028: &lt;span class="nv">$11&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 000000a8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@0000302c: &lt;span class="nv">$12&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> &lt;span class="m">00000240&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003030: &lt;span class="nv">$13&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> &lt;span class="m">00000800&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003034: &lt;span class="nv">$14&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 00001a0a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003038: &lt;span class="nv">$15&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 000001a8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@0000303c: &lt;span class="nv">$16&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 000007e8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003040: &lt;span class="nv">$16&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 0000044d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003044: &lt;span class="nv">$17&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 0000089b
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003048: &lt;span class="nv">$18&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> &lt;span class="m">00000902&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@0000304c: &lt;span class="nv">$19&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 000003e7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003050: &lt;span class="nv">$20&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 000007d5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003054: &lt;span class="nv">$21&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> &lt;span class="m">00000000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003058: &lt;span class="nv">$22&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 000000b0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@0000305c: &lt;span class="nv">$23&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> &lt;span class="m">00000268&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003060: &lt;span class="nv">$24&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 000004bd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003064: &lt;span class="nv">$25&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> &lt;span class="m">00000522&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003068: &lt;span class="nv">$26&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> &lt;span class="m">00000378&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@0000306c: &lt;span class="nv">$27&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> &lt;span class="m">00000221&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003070: &lt;span class="nv">$28&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 0000001c
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003074: $ &lt;span class="m">1&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 01a80000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003078: &lt;span class="nv">$12&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 01f40000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@0000307c: &lt;span class="nv">$24&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 00e90000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003080: &lt;span class="nv">$21&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 0000023d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003084: &lt;span class="nv">$21&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> &lt;span class="m">00000205&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003088: *00000000 &amp;lt;&lt;span class="o">=&lt;/span> &lt;span class="m">00000205&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@0000308c: &lt;span class="nv">$28&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> &lt;span class="m">00000205&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@00003094: &lt;span class="nv">$24&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> &lt;span class="m">00000522&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@000030a0: $ &lt;span class="m">5&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 0000029b
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@000030a4: &lt;span class="nv">$31&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 000030a8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@000030b8: $ &lt;span class="m">5&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> &lt;span class="m">00000457&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@000030a8: $ &lt;span class="m">5&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> &lt;span class="m">00000000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@000030ac: $ &lt;span class="m">5&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> &lt;span class="m">00000001&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@000030b0: $ &lt;span class="m">5&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> &lt;span class="m">00000009&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@000030d4: $ &lt;span class="m">1&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> ffff0000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@000030d8: $ &lt;span class="m">1&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> fffffff6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@000030dc: $ &lt;span class="m">1&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> fffffff6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">@000030f8: &lt;span class="nv">$12&lt;/span> &amp;lt;&lt;span class="o">=&lt;/span> 091d0000
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="思考题">思考题
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>阅读下面给出的 DM 的输入示例中（示例 DM 容量为 4KB，即 32bit × 1024字），根据你的理解回答，这个 addr 信号又是从哪里来的？地址信号 addr 位数为什么是 [11:2] 而不是 [9:0] ？&lt;/p>
&lt;blockquote>
&lt;p>addr信号来源于ALU的结果输出端。&lt;/p>
&lt;p>输入信号为按字节索引的地址，而DM的存储方式为按字索引，取&lt;em>&lt;strong>addr[11:2]&lt;em>&lt;strong>即等于&lt;/strong>&lt;/em>addr[9:0] &amp;laquo; 2&lt;/strong>&lt;/em>&lt;/p>&lt;/blockquote>
&lt;/li>
&lt;li>
&lt;p>思考上述两种控制器设计的译码方式，给出代码示例，并尝试对比各方式的优劣。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl"> &lt;span class="k">always&lt;/span> &lt;span class="p">@(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">OpCode&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">6&lt;/span>&lt;span class="mb">&amp;#39;b000000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Funct&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">6&lt;/span>&lt;span class="mb">&amp;#39;b100000&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//add
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">RegDst&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b01&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ALUSrc&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Mem2Reg&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RegWrite&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="mb">&amp;#39;b1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MemWrite&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">branch&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ExtOp&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ALUOP&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jumpSrc&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jump&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">1&lt;/span>&lt;span class="mb">&amp;#39;b0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-verilog" data-lang="verilog">&lt;span class="line">&lt;span class="cl">&lt;span class="k">always&lt;/span> &lt;span class="p">@(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">OpCode&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">6&lt;/span>&lt;span class="mb">&amp;#39;b100011&lt;/span> &lt;span class="o">||&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">OpCode&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">6&lt;/span>&lt;span class="mb">&amp;#39;b101011&lt;/span> &lt;span class="o">||&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">OpCode&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">6&lt;/span>&lt;span class="mb">&amp;#39;b000100&lt;/span> &lt;span class="o">||&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">OpCode&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">6&lt;/span>&lt;span class="mb">&amp;#39;b001111&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ExtOp&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b10&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">OpCode&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mh">6&lt;/span>&lt;span class="mb">&amp;#39;b001101&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ExtOp&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b01&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span> &lt;span class="k">begin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ExtOp&lt;/span> &lt;span class="o">&amp;lt;=&lt;/span> &lt;span class="mh">2&lt;/span>&lt;span class="mb">&amp;#39;b00&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;ul>
&lt;li>&lt;strong>记录指令对应的控制信号如何取值&lt;/strong>：方便添加新指令。&lt;/li>
&lt;li>&lt;strong>记录控制信号每种取值所对应的指令&lt;/strong>：方便添加控制信号。&lt;/li>
&lt;/ul>&lt;/blockquote>
&lt;/li>
&lt;li>
&lt;p>在相应的部件中，复位信号的设计都是&lt;strong>同步复位&lt;/strong>，这与 P3 中的设计要求不同。请对比&lt;strong>同步复位&lt;/strong>与&lt;strong>异步复位&lt;/strong>这两种方式的 reset 信号与 clk 信号优先级的关系。&lt;/p>
&lt;blockquote>
&lt;p>异步复位reset信号优先，同步复位clk信号优先。&lt;/p>&lt;/blockquote>
&lt;/li>
&lt;li>
&lt;p>C 语言是一种弱类型程序设计语言。C 语言中不对计算结果溢出进行处理，这意味着 C 语言要求程序员必须很清楚计算结果是否会导致溢出。因此，如果仅仅支持 C 语言，MIPS 指令的所有计算指令均可以忽略溢出。 请说明为什么在忽略溢出的前提下，addi 与 addiu 是等价的，add 与 addu 是等价的。提示：阅读《MIPS32® Architecture For Programmers Volume II: The MIPS32® Instruction Set》中相关指令的 Operation 部分。&lt;/p>
&lt;blockquote>
&lt;p>&lt;em>The term “unsigned” in the instruction name is a misnomer; this operation is 32-bit modulo arithmetic that does not trap on overflow. This instruction is appropriate for unsigned arithmetic, such as address arithmetic, or integer arithmetic environments that ignore overflow, such as C language arithmetic.&lt;/em>&lt;/p>
&lt;p>addu和add的区别、addi和addiu的区别均仅在与是否有溢出判断，故忽略溢出时效果是一样的。&lt;/p>&lt;/blockquote>
&lt;/li>
&lt;/ol></description></item><item><title>如何优雅地编写Verilog</title><link>https://lhy0424.top/p/verilog_edit/</link><pubDate>Sat, 02 Nov 2024 18:06:00 +0000</pubDate><guid>https://lhy0424.top/p/verilog_edit/</guid><description>&lt;img src="https://lhy0424.top/p/verilog_edit/vscode_teros_cover.png" alt="Featured image of post 如何优雅地编写Verilog" />&lt;h1 id="如何优雅地编写verilog">如何优雅地编写Verilog
&lt;/h1>&lt;h2 id="一替换ise默认编辑器">一、替换ISE默认编辑器
&lt;/h2>&lt;p>ISE仿佛知道自己的默认编辑器很难用，所以允许用户自定义编辑器（&lt;/p>
&lt;p>打开ISE，上方工具栏&lt;strong>Edit -&amp;gt; Preferences&lt;/strong>，在左侧Category选择&lt;strong>ISE General -&amp;gt; Editors&lt;/strong>，第一栏下拉选项选择&lt;strong>Custom&lt;/strong>，在后面一栏输入编辑器的路径，我们以sublime为例，格式如下（大括号内为自己的路径）&lt;/p>
&lt;blockquote>
&lt;p>{D:\sublime\Sublime Text\sublime_text.exe} +$2 $1&lt;/p>&lt;/blockquote>
&lt;p>&lt;img src="https://lhy0424.top/p/verilog_edit/ise_editor.png"
width="916"
height="744"
srcset="https://lhy0424.top/p/verilog_edit/ise_editor_hu_236f077b786c971.png 480w, https://lhy0424.top/p/verilog_edit/ise_editor_hu_578e688e1024d27d.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="123"
data-flex-basis="295px"
>&lt;/p>
&lt;p>设置完成后我们在ISE中点击自己verilog文件就可以自动跳转至指定编辑器了&lt;/p>
&lt;p>sublime默认并不支持verilog文件，所以我们还需要安装相关插件&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/verilog_edit/sublime_plugin.png"
width="725"
height="213"
srcset="https://lhy0424.top/p/verilog_edit/sublime_plugin_hu_2402696251ce1887.png 480w, https://lhy0424.top/p/verilog_edit/sublime_plugin_hu_bc8e18b95123f170.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="340"
data-flex-basis="816px"
>&lt;/p>
&lt;p>这些插件可以实现基本的语法补全、代码高亮等功能，效果如下&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/verilog_edit/sublime_display.png"
width="626"
height="723"
srcset="https://lhy0424.top/p/verilog_edit/sublime_display_hu_2dc2037cb739c1c2.png 480w, https://lhy0424.top/p/verilog_edit/sublime_display_hu_18ad0f30f47cc25c.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="86"
data-flex-basis="207px"
>&lt;/p>
&lt;p>在编辑器编辑完保存后，我们可以返回ISE进行后续的仿真、查看波形图等功能。&lt;/p>
&lt;h2 id="二强大的vscode插件teroshdl">二、强大的VScode插件——TerosHDL
&lt;/h2>&lt;p>&lt;img src="https://lhy0424.top/p/verilog_edit/vscode_teros.png"
width="1265"
height="253"
srcset="https://lhy0424.top/p/verilog_edit/vscode_teros_hu_6c685e9aa008245e.png 480w, https://lhy0424.top/p/verilog_edit/vscode_teros_hu_f555769537904ca8.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="500"
data-flex-basis="1200px"
>&lt;/p>
&lt;p>具体配置过程见官网：&lt;a class="link" href="https://terostechnology.github.io/terosHDLdoc/docs/intro/" target="_blank" rel="noopener"
>TerosHDL&lt;/a>&lt;/p>
&lt;p>除了基础的语法补全功能，该插件提供如下功能：&lt;/p>
&lt;ul>
&lt;li>
&lt;p>显示项目中各个模块或文件之间的层次结构和依赖关系&lt;/p>
&lt;/li>
&lt;li>
&lt;p>实时错误检查&lt;/p>
&lt;/li>
&lt;li>
&lt;p>自动模板用于testbench等&lt;/p>
&lt;/li>
&lt;li>
&lt;p>自动生成文档&lt;/p>
&lt;/li>
&lt;li>
&lt;p>生成状态机的状态转移图&lt;/p>
&lt;/li>
&lt;li>
&lt;p>代码格式化&lt;/p>
&lt;/li>
&lt;li>
&lt;p>生成原理图&lt;/p>
&lt;/li>
&lt;li>
&lt;p>以及许多编辑工具：语法高亮、悬停提示、名称重构、名称重构、代码折叠、求值字面量&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/verilog_edit/teros_function1.png"
width="1772"
height="1095"
srcset="https://lhy0424.top/p/verilog_edit/teros_function1_hu_13901c8d71870c0e.png 480w, https://lhy0424.top/p/verilog_edit/teros_function1_hu_6958632a4e189231.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="161"
data-flex-basis="388px"
>&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/verilog_edit/teros_function2.png"
width="1780"
height="1097"
srcset="https://lhy0424.top/p/verilog_edit/teros_function2_hu_7c90be6c541693eb.png 480w, https://lhy0424.top/p/verilog_edit/teros_function2_hu_a445204b2bc36fa.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="162"
data-flex-basis="389px"
>&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/verilog_edit/teros_function3.png"
width="1764"
height="1222"
srcset="https://lhy0424.top/p/verilog_edit/teros_function3_hu_697bc61da4dcad8.png 480w, https://lhy0424.top/p/verilog_edit/teros_function3_hu_1536f6060690dc51.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="144"
data-flex-basis="346px"
>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>此外，这款插件还可以集成外部工具，如使用iverilog编译、GTKWave查看波形，而且好像还支持ISE的命令行工具？期待大家进一步探索。&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/verilog_edit/teros_settings.png"
width="350"
height="706"
srcset="https://lhy0424.top/p/verilog_edit/teros_settings_hu_d38bb324dddab1c6.png 480w, https://lhy0424.top/p/verilog_edit/teros_settings_hu_73aae31fcb18e01a.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="49"
data-flex-basis="118px"
>&lt;/p>
&lt;h2 id="三vscode--ise命令行工具">三、VScode + ISE命令行工具
&lt;/h2>&lt;p>TerosHDL的配置比较麻烦，如果想简单一点，可以使用VScode + ISE命令行工具&lt;/p>
&lt;p>详情请见大佬的帖子,&lt;a class="link" href="http://cscore.buaa.edu.cn/#/discussion_area/1461/1777/posts" target="_blank" rel="noopener"
>通过命令行，更优雅地利用ISE进行开发&lt;/a>&lt;/p>
&lt;p>在VScode中编写verilog文件后，直接在VScode中新建一个.bat文件，复制以下内容，然后在文件资源管理器中双击打开即可实现一键&lt;strong>编译、仿真、查看波形&lt;/strong>，基本可以脱离ISE。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bat" data-lang="bat">&lt;span class="line">&lt;span class="cl">&lt;span class="p">@&lt;/span>&lt;span class="k">echo&lt;/span> off
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">REM 编译&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">%XILINX%&lt;/span>&lt;span class="s2">\bin\nt64\fuse.exe&amp;#34;&lt;/span> -nodebug -prj mips.prj -o mips.exe mips_tb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">IF&lt;/span> &lt;span class="k">ERRORLEVEL&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">echo&lt;/span> 编译失败，请检查错误。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">pause&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">REM 运行仿真&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mips.exe -nolog -tclbatch mips.tcl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">IF&lt;/span> &lt;span class="k">ERRORLEVEL&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">echo&lt;/span> 仿真失败，请检查错误。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">pause&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">REM 查看波形&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">%XILINX%&lt;/span>&lt;span class="s2">\bin\nt64\isimgui.exe&amp;#34;&lt;/span> -view isim.wdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">IF&lt;/span> &lt;span class="k">ERRORLEVEL&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">echo&lt;/span> 查看波形失败，请检查错误。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">pause&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">pause&lt;/span> REM 暂停，以便查看输出
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>P3_设计文档</title><link>https://lhy0424.top/p/co_p3/</link><pubDate>Sun, 27 Oct 2024 17:53:00 +0000</pubDate><guid>https://lhy0424.top/p/co_p3/</guid><description>&lt;img src="https://lhy0424.top/p/co_p3/P3_cover.jpg" alt="Featured image of post P3_设计文档" />&lt;h1 id="p3_document">P3_document
&lt;/h1>&lt;h2 id="设计草稿">设计草稿
&lt;/h2>&lt;p>本次P3搭建的CPU支持&lt;code>add, sub, ori, lw, sw, beq, lui, nop，begz，bgtz，blez，bltz，bne, j, jal&lt;/code>&lt;/p>
&lt;h3 id="ifu-instruction-fetch-unit">IFU (Instruction Fetch Unit)
&lt;/h3>&lt;p>PC和nPC内置在IFU中，通过branch信号控制PC变换逻辑&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/co_p3/IFU.png"
width="217"
height="187"
srcset="https://lhy0424.top/p/co_p3/IFU_hu_246762bdd93fcd81.png 480w, https://lhy0424.top/p/co_p3/IFU_hu_8edeabc3234aafda.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="116"
data-flex-basis="278px"
>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>端口&lt;/th>
&lt;th>方向&lt;/th>
&lt;th>描述&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Instr[31:0]&lt;/td>
&lt;td>O&lt;/td>
&lt;td>输出32位指令二进制编码&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>offset[31:0]&lt;/td>
&lt;td>I&lt;/td>
&lt;td>输入branch指令的地址偏移量&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>reset&lt;/td>
&lt;td>I&lt;/td>
&lt;td>复位信号&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>branch&lt;/td>
&lt;td>I&lt;/td>
&lt;td>是否branch&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>PC&lt;/td>
&lt;td>O&lt;/td>
&lt;td>用于测试PC&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="controller">Controller
&lt;/h3>&lt;p>用于控制信息通路中的多路选择器，选择正确的功能&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/co_p3/Controller.png"
width="237"
height="293"
srcset="https://lhy0424.top/p/co_p3/Controller_hu_637e88a6f8be578b.png 480w, https://lhy0424.top/p/co_p3/Controller_hu_34a96c4feeda354e.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="80"
data-flex-basis="194px"
>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>add&lt;/th>
&lt;th>sub&lt;/th>
&lt;th>ori&lt;/th>
&lt;th>lw&lt;/th>
&lt;th>sw&lt;/th>
&lt;th>beq&lt;/th>
&lt;th>lui&lt;/th>
&lt;th>bgez&lt;/th>
&lt;th>bgtz&lt;/th>
&lt;th>blez&lt;/th>
&lt;th>bltz&lt;/th>
&lt;th>bne&lt;/th>
&lt;th>jump&lt;/th>
&lt;th>jal&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;strong>OpCode&lt;/strong>&lt;/td>
&lt;td>000000&lt;/td>
&lt;td>000000&lt;/td>
&lt;td>001101&lt;/td>
&lt;td>100011&lt;/td>
&lt;td>101011&lt;/td>
&lt;td>000100&lt;/td>
&lt;td>001111&lt;/td>
&lt;td>000001&lt;/td>
&lt;td>000111&lt;/td>
&lt;td>000110&lt;/td>
&lt;td>000001&lt;/td>
&lt;td>000101&lt;/td>
&lt;td>000010&lt;/td>
&lt;td>000011&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Function&lt;/strong>&lt;/td>
&lt;td>100000&lt;/td>
&lt;td>100010&lt;/td>
&lt;td>xxxxxx&lt;/td>
&lt;td>xxxxxx&lt;/td>
&lt;td>xxxxxx&lt;/td>
&lt;td>xxxxxx&lt;/td>
&lt;td>xxxxxx&lt;/td>
&lt;td>00001&lt;/td>
&lt;td>xxxxxx&lt;/td>
&lt;td>xxxxxx&lt;/td>
&lt;td>00000&lt;/td>
&lt;td>xxxxxx&lt;/td>
&lt;td>xxxxxx&lt;/td>
&lt;td>xxxxxx&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>add&lt;/th>
&lt;th>sub&lt;/th>
&lt;th>ori&lt;/th>
&lt;th>lw&lt;/th>
&lt;th>sw&lt;/th>
&lt;th>branch&lt;/th>
&lt;th>lui&lt;/th>
&lt;th>jump&lt;/th>
&lt;th>jal&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>RegDst&lt;/td>
&lt;td>01&lt;/td>
&lt;td>01&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>11(const31)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ALUSrc&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Mem2Reg&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>01&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>10(PC + 4)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>RegWrite&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>MemWrite&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>nPC_Sel&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ExtOp&lt;/td>
&lt;td>00&lt;/td>
&lt;td>00&lt;/td>
&lt;td>01(zero)&lt;/td>
&lt;td>10(signed)&lt;/td>
&lt;td>10(signed)&lt;/td>
&lt;td>10(signed)&lt;/td>
&lt;td>10(signed)&lt;/td>
&lt;td>00&lt;/td>
&lt;td>0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ALUOP&amp;lt;1,0&amp;gt;&lt;/td>
&lt;td>00&lt;/td>
&lt;td>01&lt;/td>
&lt;td>10&lt;/td>
&lt;td>00(+)&lt;/td>
&lt;td>00(+)&lt;/td>
&lt;td>00(+)&lt;/td>
&lt;td>11&lt;/td>
&lt;td>00&lt;/td>
&lt;td>0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>jump&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>0&lt;/td>
&lt;td>1&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>beq&lt;/th>
&lt;th>bgez&lt;/th>
&lt;th>bgtz&lt;/th>
&lt;th>blez&lt;/th>
&lt;th>bltz&lt;/th>
&lt;th>bne&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>bOp&lt;/td>
&lt;td>100000&lt;/td>
&lt;td>010000&lt;/td>
&lt;td>001000&lt;/td>
&lt;td>000100&lt;/td>
&lt;td>000010&lt;/td>
&lt;td>000001&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="grf-general-register-file">GRF (General Register File)
&lt;/h3>&lt;p>&lt;img src="https://lhy0424.top/p/co_p3/GRF.png"
width="153"
height="189"
srcset="https://lhy0424.top/p/co_p3/GRF_hu_eb7f16537f4c59f2.png 480w, https://lhy0424.top/p/co_p3/GRF_hu_89a3424de69e6891.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="80"
data-flex-basis="194px"
>&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>引用自P0_Q2&lt;/strong>&lt;/p>
&lt;p>GRF中包含32个32位寄存器，分别对应0~31号寄存器，其中0号寄存器读取的结果恒为0。&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/co_p3/GRF_signal.png"
width="745"
height="512"
srcset="https://lhy0424.top/p/co_p3/GRF_signal_hu_ad9e30dc0d93fe33.png 480w, https://lhy0424.top/p/co_p3/GRF_signal_hu_b9950bfe607dc030.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="145"
data-flex-basis="349px"
>&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/co_p3/GRF_function.png"
width="744"
height="185"
srcset="https://lhy0424.top/p/co_p3/GRF_function_hu_f739ed04f5634ca4.png 480w, https://lhy0424.top/p/co_p3/GRF_function_hu_b6bc04b00c322bb2.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="402"
data-flex-basis="965px"
>&lt;/p>&lt;/blockquote>
&lt;h3 id="alu-arithmetic-logic-unit">ALU (Arithmetic Logic Unit)
&lt;/h3>&lt;p>&lt;img src="https://lhy0424.top/p/co_p3/ALU.png"
width="141"
height="143"
srcset="https://lhy0424.top/p/co_p3/ALU_hu_98f1645a0857296b.png 480w, https://lhy0424.top/p/co_p3/ALU_hu_39fa86313d2598e7.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="98"
data-flex-basis="236px"
>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>ALUOP&lt;/th>
&lt;th>描述&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>00&lt;/td>
&lt;td>加法&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>01&lt;/td>
&lt;td>减法&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>10&lt;/td>
&lt;td>或&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>11&lt;/td>
&lt;td>立即数加载到高位&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="ext-extend">EXT (Extend)
&lt;/h3>&lt;p>用于数据扩展&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/co_p3/ExtOp.png"
width="200"
height="102"
srcset="https://lhy0424.top/p/co_p3/ExtOp_hu_81fec8418b7be79.png 480w, https://lhy0424.top/p/co_p3/ExtOp_hu_5fb2d3520595f292.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="196"
data-flex-basis="470px"
>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>ExtOp&lt;/th>
&lt;th>操作&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>00&lt;/td>
&lt;td>无操作&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>01&lt;/td>
&lt;td>0扩展&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>10&lt;/td>
&lt;td>signed扩展&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>11&lt;/td>
&lt;td>1扩展&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="bchecker-branch-checker">bChecker (Branch Checker)
&lt;/h3>&lt;p>用于判断是否跳转&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/co_p3/bCheck.png"
width="240"
height="156"
srcset="https://lhy0424.top/p/co_p3/bCheck_hu_f5f69a4f47ea413d.png 480w, https://lhy0424.top/p/co_p3/bCheck_hu_db5c5a13ef869db6.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="153"
data-flex-basis="369px"
>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>端口&lt;/th>
&lt;th>方向&lt;/th>
&lt;th>描述&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>bOp&lt;/td>
&lt;td>I&lt;/td>
&lt;td>连接到Controller.bOp，获取branch类型&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>branch&lt;/td>
&lt;td>I&lt;/td>
&lt;td>连接到Controller.branch，判断是否是branch信号&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>G[rs]&lt;/td>
&lt;td>I&lt;/td>
&lt;td>连接到GRF.RD1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>G[rt]&lt;/td>
&lt;td>I&lt;/td>
&lt;td>连接到GFR.RD2&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>check&lt;/td>
&lt;td>O&lt;/td>
&lt;td>判断是否符合branch条件，连接到IFU.branch&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="jumpext">jumpEXT
&lt;/h3>&lt;p>用于实现jump和jal指令，计算 &lt;em>&lt;strong>PC31&amp;hellip;28 || Instr_index || 00&lt;/strong>&lt;/em>&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/co_p3/jump.png"
width="152"
height="107"
srcset="https://lhy0424.top/p/co_p3/jump_hu_583c9b61f0be0644.png 480w, https://lhy0424.top/p/co_p3/jump_hu_48fb96d38eed6c7e.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="142"
data-flex-basis="340px"
>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>端口&lt;/th>
&lt;th>方向&lt;/th>
&lt;th>描述&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>index&lt;/td>
&lt;td>I&lt;/td>
&lt;td>获取Instr_index，即机器码的后26位&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>PC&lt;/td>
&lt;td>I&lt;/td>
&lt;td>获取PC的值&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ext32&lt;/td>
&lt;td>O&lt;/td>
&lt;td>下一个PC的值（nPC）&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="测试方案">测试方案
&lt;/h2>&lt;p>随机生成数据 -&amp;gt; 导出十六进制文件 -&amp;gt; 自动化工具生成新电路 -&amp;gt; 比对mars运行结果和circ运行结果&lt;/p>
&lt;p>&lt;strong>randomMipsCmd.py&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">random&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">time&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">generate_register&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;&amp;#34;&amp;#34;生成一个随机寄存器编号（0-31）。&amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">31&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">generate_immediate&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;&amp;#34;&amp;#34;生成一个随机立即数（0-65535）。&amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">65535&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">generate_memory_address&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;&amp;#34;&amp;#34;生成一个随机内存地址（0-3071，左移2位）。&amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3071&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">write_instruction&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">instruction&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;&amp;#34;&amp;#34;将指令写入文件。&amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">instruction&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">time&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">length&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">int&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">input&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;请输入要生成的指令数量：&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">label_count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;result.asm&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;w&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">file&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">_&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">length&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tmp&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">8&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">match&lt;/span> &lt;span class="n">tmp&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">write_instruction&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;add $&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">generate_register&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">, $&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">generate_register&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">, $&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">generate_register&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">write_instruction&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;sub $&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">generate_register&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">, $&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">generate_register&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">, $&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">generate_register&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">write_instruction&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;ori $&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">generate_register&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">, $&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">generate_register&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">, &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">generate_immediate&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">write_instruction&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;lw $&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">generate_register&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">, &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">generate_memory_address&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">($0)&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">write_instruction&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;sw $&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">generate_register&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">, &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">generate_memory_address&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">($0)&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">label_count&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">num1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">generate_register&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">num2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">generate_register&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="n">num2&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">num1&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">num2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">generate_register&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">write_instruction&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;ori $&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">num1&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">, $&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">num1&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">, &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">generate_immediate&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">write_instruction&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;beq $&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">num1&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">, $&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">num2&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">, label&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">randint&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">label_count&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">write_instruction&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;lui $&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">generate_register&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">, &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">generate_immediate&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="mi">7&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">write_instruction&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;nop&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="mi">8&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">write_instruction&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;label&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">label_count&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">:&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">label_count&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="vm">__name__&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">main&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>autoWrite2Rom.py&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">re&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 读取 ROM 文件内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;python&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="s2">autoTest_P3&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="s2">rom.txt&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;r&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;utf-8&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rom_content&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">read&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># 去掉前后空白字符&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 读取电路文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;python&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="s2">autoTest_P3&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="s2">cpu.circ&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;r&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;utf-8&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">cur_file&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cur_content&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cur_file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">read&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 使用正则表达式替换 ROM 内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cur_content&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">re&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sub&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;addr/data: 12 32([\s\S]*?)&amp;lt;/a&amp;gt;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1"># 使用非贪婪模式匹配&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sa">f&lt;/span>&lt;span class="s1">&amp;#39;addr/data: 12 32&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">rom_content&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;lt;/a&amp;gt;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cur_content&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">flags&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">re&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DOTALL&lt;/span> &lt;span class="c1"># 允许 . 匹配换行符&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 写入新的电路文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;cpu_remake.circ&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;w&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;utf-8&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">file&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cur_content&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="思考题">思考题
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>&lt;strong>上面我们介绍了通过 FSM 理解单周期 CPU 的基本方法。请大家指出单周期 CPU 所用到的模块中，哪些发挥状态存储功能，哪些发挥状态转移功能。&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>状态存储功能：IFU、GRF&lt;/li>
&lt;li>状态转移功能：Controller、ALU、EXT、bCheckTT&lt;/li>
&lt;/ul>&lt;/blockquote>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>现在我们的模块中 IM 使用 ROM， DM 使用 RAM， GRF 使用 Register，这种做法合理吗？ 请给出分析，若有改进意见也请一并给出。&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>合理&lt;/p>
&lt;ul>
&lt;li>ROM是只读存储器，不会被写入，内部数据不会被修改，适合用来储存指令。&lt;/li>
&lt;li>RAM可以存取存储器，可以被写入可以被读取，适合用来读取数据。&lt;/li>
&lt;li>GRF是寄存器堆，Register具有较高的读写速度，适合用来存储指令中的数据。&lt;/li>
&lt;/ul>&lt;/blockquote>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>在上述提示的模块之外，你是否在实际实现时设计了其他的模块？如果是的话，请给出介绍和设计的思路。&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>额外设计了Branch Checker，用于判断是否branch，设计思路见&amp;quot;设计草稿&amp;quot;&lt;/p>&lt;/blockquote>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>事实上，实现 &lt;code>nop&lt;/code> 空指令，我们并不需要将它加入控制信号真值表，为什么？&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>nop的指令码是0x00000000，会被翻译为*** sll $0, $0 0***，即把$0的值左移0位存入$0，因为$0的值始终为零不会被改变，所以nop不会带来电路的任何改变。&lt;/p>&lt;/blockquote>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>阅读 Pre 的 &lt;a class="link" href="http://cscore.buaa.edu.cn/tutorial/mips/mips-6/mips6-1/" target="_blank" rel="noopener"
>“MIPS 指令集及汇编语言”&lt;/a> 一节中给出的测试样例，评价其强度（可从各个指令的覆盖情况，单一指令各种行为的覆盖情况等方面分析），并指出具体的不足之处。&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>强度一般&lt;/p>
&lt;p>没有测试到所有的寄存器，也没有考虑到数据溢出的情况&lt;/p>&lt;/blockquote>
&lt;/li>
&lt;/ol></description></item><item><title>Moore与Mealy状态机辨析</title><link>https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/</link><pubDate>Sat, 05 Oct 2024 16:58:00 +0000</pubDate><guid>https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/</guid><description>&lt;img src="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/Automata_theory.svg.png" alt="Featured image of post Moore与Mealy状态机辨析" />&lt;h4 id="有限状态机">有限状态机
&lt;/h4>&lt;p>表示有限个状态以及在这些状态之间的转移和动作等行为的&lt;strong>数学统计模型&lt;/strong>。&lt;/p>
&lt;h4 id="有限状态机fsm组成部分">有限状态机（FSM）组成部分
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>&lt;strong>State&lt;/strong> : 系统可能处于的状态。每个状态反映的是系统的某个模式或环节。有限状态机的状态是有限的。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Input&lt;/strong> : 外部输入的信号，会影响状态的转换。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Output&lt;/strong> : 状态机在特定条件下输出的信号。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Transitions&lt;/strong> : 系统根据状态转移函数从一个状态转移到另一个状态。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>Initial State&lt;/strong> : 系统的初始状态。&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="例题字符串匹配">例题（字符串匹配）
&lt;/h4>&lt;p>在了解有限状态机的两种类型前，我们先来看一道例题（选自BUAA_CO_P0）&lt;/p>
&lt;blockquote>
&lt;p>使用Logisim搭建一个有限状态机检测串行输入字符串中的能匹配正则表达式b{1,2}[ac]{2}的子串并输出。即我们要得到这样一个字符串：开头有一个或两个b，接着要出现两次a/c。&lt;/p>
&lt;p>**注意：**每当匹配到一个子串时，需要输出一次1。例如对字符串bacbacac,模块应当在第1个c输入和第2个c输入时输出1,而在其他时刻保持输出为0。&lt;/p>&lt;/blockquote>
&lt;h4 id="moore-machine">Moore Machine
&lt;/h4>&lt;p>我们先通过Moore状态机来实现题目要求。Moore状态机是有限状态机的一种，其输出仅依赖于当前状态。即只要系统处于某个特定状态，无论当前输入是什么，都会有对应的输出。&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/moore.png"
width="593"
height="185"
srcset="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/moore_hu_a0dfd89ec93ac608.png 480w, https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/moore_hu_d0425ae1602f2bbd.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="320"
data-flex-basis="769px"
>&lt;/p>
&lt;p>首先我们先画出&lt;strong>状态转移图&lt;/strong>&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/moore_transition.png"
width="701"
height="233"
srcset="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/moore_transition_hu_c8e35ce45212ce20.png 480w, https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/moore_transition_hu_bd834bbc6277a871.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="300"
data-flex-basis="722px"
>&lt;/p>
&lt;p>根据上图我们可以轻松地在&lt;strong>logisim&lt;/strong>中搭出相应的电路&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/moore_table.png"
width="643"
height="420"
srcset="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/moore_table_hu_a576e50aa1a57b13.png 480w, https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/moore_table_hu_b32c45cd15ee5ee7.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="153"
data-flex-basis="367px"
>&lt;/p>
&lt;p align = "center">&lt;i>&lt;font color = "gray">利用真值表构建状态转移模块&lt;/font>&lt;/i>&lt;p>
&lt;p>&lt;img src="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/moore_logisim.png"
width="623"
height="229"
srcset="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/moore_logisim_hu_19dba5df5ff99878.png 480w, https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/moore_logisim_hu_dd6b173fbd2a0ec9.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="272"
data-flex-basis="652px"
>&lt;/p>
&lt;h4 id="mealy-machine">Mealy Machine
&lt;/h4>&lt;p>再利用Mealy状态机实现题目要求。Mealy状态机是有限状态机的另外一种，其输出结果不仅和当前状态有关，还和当前输出有关。&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/mealy.png"
width="593"
height="201"
srcset="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/mealy_hu_b227e79b60b799f7.png 480w, https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/mealy_hu_797c9108c2bb94b7.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="295"
data-flex-basis="708px"
>&lt;/p>
&lt;p>我们仍然是先画出&lt;strong>状态转移图&lt;/strong>&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/mealy_transition.png"
width="701"
height="233"
srcset="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/mealy_transition_hu_afe6e998c107cd85.png 480w, https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/mealy_transition_hu_30415e718ab41b09.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="300"
data-flex-basis="722px"
>&lt;/p>
&lt;p>在&lt;strong>logisim&lt;/strong>中搭建相应电路&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/mealy_table.png"
width="735"
height="416"
srcset="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/mealy_table_hu_9404a3165c6ba825.png 480w, https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/mealy_table_hu_1aed7ce11eba17e1.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="176"
data-flex-basis="424px"
>&lt;/p>
&lt;p align = "center">&lt;i>&lt;font color = "gray">利用真值表构建状态转移模块&lt;/font>&lt;/i>&lt;p>
&lt;p>由于Mealy状态机的输出Z由状态和输出共同决定，所以可以在构建真值表时直接根据状态和输入给出Z的值。&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/mealy_logisim.png"
width="555"
height="211"
srcset="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/mealy_logisim_hu_a937017219dbd312.png 480w, https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/mealy_logisim_hu_111bb1fc4d2ac999.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="263"
data-flex-basis="631px"
>&lt;/p>
&lt;h4 id="moore--mealy">Moore &amp;amp; Mealy
&lt;/h4>&lt;p>下面我们通过波形图的方式分析两种有限状态机的差别。&lt;/p>
&lt;ul>
&lt;li>上升沿输入一个字符，且输入在一个周期内保持不变&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/wave_posedge.png"
width="452"
height="237"
srcset="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/wave_posedge_hu_359ba7a370f56290.png 480w, https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/wave_posedge_hu_2e0a0be18a5989db.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="190"
data-flex-basis="457px"
>&lt;/p>
&lt;p>Moore状态机在读入字符c后状态变为11，经过判断符合置位条件，输入变为1，非常符合我们的直觉。&lt;/p>
&lt;p>Mealy状态机则在读入字符a后输入就变为1，因为读入a之后状态变为10，此时输入仍为a，状态机识别到字符序列baa，符合置位条件，输入变为1，而在读入c之后状态变为00，不再符合置位条件。&lt;/p>
&lt;ul>
&lt;li>
&lt;p>下降沿输入一个字符，且输入在一个周期内保持不变&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/wave_negedge.png"
width="452"
height="237"
srcset="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/wave_negedge_hu_999d69a74283a5d0.png 480w, https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/wave_negedge_hu_fa0c1b2dc415861f.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="190"
data-flex-basis="457px"
>&lt;/p>
&lt;p>虽然是下降沿读入一个字符，但是状态机的状态在上升沿时才会更新，所以对于Moore状态机，其实就等于上一种情况滞后一个周期。&lt;/p>
&lt;p>对于Mealy状态机，在状态更新为10后，输入仍为a，检测序列为baa，符合置位条件，在之后的下降沿输入变为c，此时检测序列为bac，仍符合置位条件。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>异步输入&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/wave_async_true.png"
width="452"
height="237"
srcset="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/wave_async_true_hu_63ec90afc72bd0cb.png 480w, https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/wave_async_true_hu_6221b091fc98f9d5.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="190"
data-flex-basis="457px"
>&lt;/p>
&lt;p>&lt;img src="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/wave_async_fal.png"
width="452"
height="237"
srcset="https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/wave_async_fal_hu_f3e809c7ad84454e.png 480w, https://lhy0424.top/p/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/wave_async_fal_hu_84a489208c734f57.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="190"
data-flex-basis="457px"
>&lt;/p>
&lt;p>在接收到字符a后的一个周期内任意时刻输入c，Mealy状态机的输出都会立刻发生变化，而Moore状态机则需要等到下一个时钟上沿到来输出才会变化。&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="总结">总结
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>对于本题来说，Moore状态机和Mealy状态机实现的功能有所差异。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>**Moore状态机同步输出，Mealy状态机异步输出。**Mealy对输入的反应更快。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>实现相同功能，Mealy所需要的状态数比Moore型少，Moore需要状态稳定才能输出。（对于异步输入来说，因为同步输入时结果并不相同）&lt;/p>
&lt;/li>
&lt;li>
&lt;p>并非所有时许电路都可以用Mealy状态机实现，一些时序逻辑电路只能通过Moore状态机实现。&lt;/p>
&lt;/li>
&lt;/ul></description></item></channel></rss>